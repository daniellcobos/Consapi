<!DOCTYPE html>
<html data-bs-theme="light" lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Smart Solutions - Simulador Tork</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i&amp;display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
     <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>

<body>

    <nav id="autoHideNavbar" class="navbar navbar-light fixed-top" style="background-color:#ffffff;">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand logo fs-5 d-flex align-items-center" href="#">
                <img src="https://essity-images.essity.com/images-c5/63/169063/optimized-w1440_jpg/tork-logo-blue-cmyk.jpg?w=1080&h=100000&imPolicy=dynamic" alt="Tork Vision Logo" class="me-2" width="60" height="40" onerror="this.style.display='none'">
                Smart Solutions
            </a>
            <h1 class="fs-5 fw-bold text-center d-none d-md-block" style="font-size: larger;">Simulador de Consumo Mensual Institucional ¡en solo 7 pasos!</h1>
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" type="button" id="externalLinksDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Saber más...
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="externalLinksDropdown">
                    <li><a class="dropdown-item" href="https://familiainstitucional.com/blog/familia-institucional-ahora-es-tork" target="_blank">¿Por qué Tork?</a></li>
                    <li><a class="dropdown-item" href="https://www.cuidateenfamilia.com/productos-tork" target="_blank">Catálogo de productos</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="https://www.tork.com/contacto" target="_blank">Contacto</a></li>
                    <li><a class="dropdown-item" href="https://www.tork.com/soporte" target="_blank">Soporte técnico</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="bg-gray-50 p-4 md:p-8 min-h-screen">
        <div class="max-w-screen-2xl mx-auto">
            <div class="horizontal-steps-indicator flex justify-center items-center space-x-1 md:space-x-2 mb-8 md:hidden">
                <div id="horizontal-step-indicator-1" class="step-indicator step-active w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-blue-600 text-white">1</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-2" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">2</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-3" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">3</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-4" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">4</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-5" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">5</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-6" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">6</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-7" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">7</div>
            </div>

            <div class="main-grid grid grid-cols-1 lg:grid-cols-[280px_1fr_350px] gap-6 md:gap-8">
                <aside class="vertical-steps-indicator hidden md:block bg-white p-4 rounded-lg shadow-sm border border-gray-100 self-start" style="min-height: 55vh;">
                    <nav class="steps-nav">
                        <ul>
                            <li id="nav-step-1" class="step active"><span class="step-number">1</span> Sector Empresa</li>
                            <li id="nav-step-2" class="step"><span class="step-number">2</span> Tamaño Empresa</li>
                            <li id="nav-step-3" class="step"><span class="step-number">3</span> Jornada Laboral</li>
                            <li id="nav-step-4" class="step"><span class="step-number">4</span> Demografía y Baños</li>
                            <li id="nav-step-5" class="step"><span class="step-number">5</span> Tipos de Publico</li>
                            <li id="nav-step-6" class="step"><span class="step-number">6</span> Seleccion de referencias</li>
                            <li id="nav-step-7" class="step"><span class="step-number">7</span> Estimación Consumo</li>
                        </ul>
                    </nav>
                </aside>

                <main id="form-container">
                    <div id="step-1" class="step-content fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6">
                            <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">1</div>
                            <h2 class="text-2xl font-bold text-gray-800">Sector de la Empresa</h2>
                        </div>
                        <div class="space-y-5 mb-8">
                            <p class="text-gray-600 font-medium">Selecciona el sector al que pertenece tu empresa:</p>
                            <div>
                                <label for="companySector" class="block text-sm font-medium text-gray-700 mb-2">Sector:</label>
                                <div class="relative">
                                    <select id="companySector" name="companySector" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 appearance-none pr-10 bg-white">
                                        <option value="" disabled selected>-- Selecciona un sector --</option>
                                        <option value="oficinas">Oficinas / Corporativo</option>
                                        <option value="industria">Industria / Manufactura</option>
                                        <option value="salud">Salud (Hospitales, Clínicas)</option>
                                        <option value="educacion">Educación (Colegios, Universidades)</option>
                                        <option value="horeca">HoReCa (Hoteles, Restaurantes, Cafeterías)</option>
                                        <option value="retail">Retail / Comercio</option>
                                        <option value="publico">Sector Público / Gobierno</option>
                                        <option value="otro">Otro</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                                <p id="sectorError" class="text-red-500 text-sm mt-2 hidden">Por favor, selecciona un sector.</p>
                            </div>
                        </div>
                        <div class="flex justify-end mt-8">
                            <button id="next-step-1" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">
                                Siguiente <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>

                    <div id="step-2" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6">
                            <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">2</div>
                            <h2 class="text-2xl font-bold text-gray-800">Tamaño de la Empresa</h2>
                        </div>
                        <div class="space-y-5 mb-8">
                            <p class="text-gray-600 font-medium">Selecciona el tamaño de la empresa o ingresa el número exacto de empleados:</p>
                            <div class="grid gap-3">
                                <label class="relative flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-indigo-500 cursor-pointer transition-all duration-200 group">
                                    <input type="radio" name="companySize" value="small" class="peer sr-only">
                                    <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-4 transition-all duration-200 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 group-hover:border-indigo-400"><div class="w-3 h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100"></div></div>
                                    <div><span class="font-medium text-gray-800">Pequeña</span><p class="text-sm text-gray-500">11-50 empleados</p></div>
                                </label>
                                <label class="relative flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-indigo-500 cursor-pointer transition-all duration-200 group">
                                    <input type="radio" name="companySize" value="medium" class="peer sr-only">
                                    <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-4 transition-all duration-200 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 group-hover:border-indigo-400"><div class="w-3 h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100"></div></div>
                                    <div><span class="font-medium text-gray-800">Mediana</span><p class="text-sm text-gray-500">51-200 empleados</p></div>
                                </label>
                                <label class="relative flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-indigo-500 cursor-pointer transition-all duration-200 group">
                                    <input type="radio" name="companySize" value="large" class="peer sr-only" checked> <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-4 transition-all duration-200 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 group-hover:border-indigo-400"><div class="w-3 h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100"></div></div>
                                    <div><span class="font-medium text-gray-800">Grande</span><p class="text-sm text-gray-500">Más de 200 empleados</p></div>
                                </label>
                            </div>
                            <div class="flex items-center mt-6 border-t pt-4 border-gray-100">
                                <label class="relative inline-flex cursor-pointer items-center group">
                                    <input type="checkbox" id="manualEmployeeToggle" class="peer sr-only">
                                    <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                    <span class="ml-3 text-gray-700 cursor-pointer font-medium">Ingresar número exacto</span>
                                </label>
                            </div>
                            <div id="manualEmployeeInputDiv" class="hidden mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <label for="exactEmployees" class="block text-sm font-medium text-gray-700 mb-2">Número Exacto de Empleados:</label>
                                <div class="relative">
                                    <input type="number" id="exactEmployees" name="exactEmployees" min="1" class="w-full p-3 pr-12 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 75">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg></div>
                                </div>
                                <p id="employeeError" class="text-red-500 text-sm mt-2 hidden">Por favor, ingresa un número válido de empleados.</p>
                            </div>
                        </div>
                        <div class="flex justify-between mt-8">
                             <button id="back-step-2" class="btn-secondary flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás
                            </button>
                            <button id="next-step-2" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">
                                Siguiente <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>

                    <div id="step-3" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6">
                            <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">3</div>
                            <h2 class="text-2xl font-bold text-gray-800">Jornada Laboral</h2>
                        </div>
                        <div class="space-y-5 mb-8">
                            <p class="text-gray-600 font-medium">Ingresa los días trabajados al mes y las horas trabajadas al día:</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="daysWorkedPerMonth" class="block text-sm font-medium text-gray-700 mb-1">Días trabajados al mes:</label>
                                    <input type="number" id="daysWorkedPerMonth" name="daysWorkedPerMonth" min="1" max="31" value="20" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 20">
                                </div>
                                <div>
                                    <label for="hoursWorkedPerDay" class="block text-sm font-medium text-gray-700 mb-1">Horas trabajadas al día:</label>
                                    <input type="number" id="hoursWorkedPerDay" name="hoursWorkedPerDay" min="1" max="24" value="8" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 8">
                                </div>
                            </div>
                            <p id="workHoursError" class="text-red-500 text-sm mt-2 hidden">Por favor, ingresa valores válidos para días y horas.</p>
                        </div>
                        <div class="flex justify-between mt-8">
                             <button id="back-step-3" class="btn-secondary flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás
                            </button>
                            <button id="next-step-3" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">
                                Siguiente <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>

                    <div id="step-4" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                         <div class="flex items-center mb-6">
                             <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">4</div>
                             <h2 class="text-2xl font-bold text-gray-800">Demografía y Baños</h2>
                         </div>
                         <div class="space-y-8">
                             <div class="bg-gray-50 rounded-lg p-5 border border-gray-200">
                                 <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-600" viewBox="0 0 20 20" fill="currentColor"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" /></svg>Distribución de Empleados</h3>
                                 <p class="text-gray-600 mb-4">El sistema estima la siguiente distribución (60% hombres, 40% mujeres). Puedes ajustarla si es necesario.</p>
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-5">
                                     <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm"><label class="block text-sm font-medium text-gray-500">Hombres (Estimado)</label><div class="flex items-center mt-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg><p id="estimatedMen" class="text-xl font-bold text-gray-900">--</p></div></div>
                                     <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm"><label class="block text-sm font-medium text-gray-500">Mujeres (Estimado)</label><div class="flex items-center mt-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg><p id="estimatedWomen" class="text-xl font-bold text-gray-900">--</p></div></div>
                                 </div>
                                 <div class="flex items-center mt-4"><label class="relative inline-flex cursor-pointer items-center group"><input type="checkbox" id="manualDemographicsToggle" class="peer sr-only"><div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div><span class="ml-3 text-gray-700 cursor-pointer font-medium">Ingresar números manualmente</span></label></div>
                                 <div id="manualDemographicsInputDiv" class="hidden mt-5 grid grid-cols-1 md:grid-cols-2 gap-5">
                                     <div class="relative"><label for="manualMen" class="block text-sm font-medium text-gray-700 mb-2">Número de Hombres:</label><div class="relative"><input type="number" id="manualMen" name="manualMen" min="0" class="w-full p-3 pl-10 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 30"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg></div></div></div>
                                     <div class="relative"><label for="manualWomen" class="block text-sm font-medium text-gray-700 mb-2">Número de Mujeres:</label><div class="relative"><input type="number" id="manualWomen" name="manualWomen" min="0" class="w-full p-3 pl-10 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 20"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg></div></div></div>
                                 </div>
                                 <p id="demographicsError" class="text-red-500 text-sm mt-3 hidden bg-red-50 p-2 rounded-lg border border-red-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>La suma de hombres y mujeres debe ser igual al total de empleados.</p>
                             </div>
                             <div class="bg-gray-50 rounded-lg p-5 border border-gray-200">
                                 <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clip-rule="evenodd" /></svg>Instalaciones</h3>
                                 <p class="text-gray-600 mb-4">El sistema estima el número de baños necesarios (1 por cada 15 empleados, de acuerdo a la normatividad Colombiana). Puede ajustarlo.</p>
                                 <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm mb-5 w-full md:w-1/2"><label class="block text-sm font-medium text-gray-500">Baños (Estimado)</label><div class="flex items-center mt-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-teal-600 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg><p id="estimatedBathrooms" class="text-xl font-bold text-gray-900">--</p></div></div>
                                 <div class="flex items-center mt-4"><label class="relative inline-flex cursor-pointer items-center group"><input type="checkbox" id="manualBathroomsToggle" class="peer sr-only"><div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div><span class="ml-3 text-gray-700 cursor-pointer font-medium">Ingresar número manualmente</span></label></div>
                                 <div id="manualBathroomsInputDiv" class="hidden mt-5"><div class="relative w-full md:w-1/2"><label for="manualBathrooms" class="block text-sm font-medium text-gray-700 mb-2">Número de Baños:</label><div class="relative"><input type="number" id="manualBathrooms" name="manualBathrooms" min="1" class="w-full p-3 pl-10 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 5"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-teal-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg></div></div><p id="bathroomError" class="text-red-500 text-sm mt-3 hidden bg-red-50 p-2 rounded-lg border border-red-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>Por favor, ingresa un número válido de baños.</p></div></div>
                             </div>
                         </div>
                         <div class="flex justify-between mt-8">
                             <button id="back-step-4" class="btn-secondary flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás</button>
                             <button id="next-step-4" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">Siguiente <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>
                         </div>
                    </div>

                    <div id="step-5" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6">
                            <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">5</div>
                            <h2 class="text-2xl font-bold text-gray-800">Tipos de Público</h2>
                        </div>
                        <div class="space-y-5 mb-8">
                            <p class="text-gray-600 font-medium">Ingresa la cantidad de personas para cada tipo de público. La suma de Administrativos y Flotantes debe ser igual al total de empleados (<span id="totalEmployeesForAudience" class="font-bold">--</span>).</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="audienceAdministrative" class="block text-sm font-medium text-gray-700 mb-1">Administrativo:</label>
                                    <input type="number" id="audienceAdministrative" name="audienceAdministrative" min="0" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 25">
                                </div>
                                <div>
                                    <label for="audienceOperative" class="block text-sm font-medium text-gray-700 mb-1">Operativo:</label>
                                    <input type="number" id="audienceOperative" name="audienceOperative" min="0" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 50">
                                </div>
                                <div>
                                    <label for="audienceFloating" class="block text-sm font-medium text-gray-700 mb-1">Flotante:</label>
                                    <input type="number" id="audienceFloating" name="audienceFloating" min="0" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 10">
                                </div>
                            </div>
                             <p id="audienceError" class="text-red-500 text-sm mt-3 hidden bg-red-50 p-2 rounded-lg border border-red-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>Error en la distribución del público.</p>
                        </div>
                        <div class="flex justify-between mt-8">
                            <button id="back-step-5" class="btn-secondary flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás
                           </button>
                           <button id="next-step-5" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">
                                Calcular Consumo <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm2 10a1 1 0 10-2 0v3a1 1 0 102 0v-3zm2-3a1 1 0 011 1v5a1 1 0 11-2 0v-5a1 1 0 011-1zm4-1a1 1 0 10-2 0v7a1 1 0 102 0V8z" clip-rule="evenodd" /></svg>
                           </button>
                        </div>
                    </div>

                    <div id="step-6-new-references" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                         <div class="flex items-center mb-6">
                            <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">6</div>
                            <h2 class="text-2xl font-bold text-gray-800">Seleccion de Referencias</h2>
                        </div>
                        <div class="space-y-5 mb-8">
                            <div class="relative">
                                 <label for="phrefs" class="block text-sm font-medium text-gray-700 mb-2">Referencia Papel Higienico:</label>
                                    <select id="phrefs" name="phrefs" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 appearance-none pr-10 bg-white">
                                        <option value="na">Ninguna</option>
                                    </select>
                                 <label for="htrefs" class="block text-sm font-medium text-gray-700 mb-2">Referencias Toallas de Manos:</label>
                                 <select id="htrefs" name="htrefs" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 appearance-none pr-10 bg-white">
                                     <option value="na">Ninguna</option>
                                    </select>
                                 <label for="srefs" class="block text-sm font-medium text-gray-700 mb-2">Referencias Jabon de Manos:</label>
                                 <select id="srefs" name="srefs" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 appearance-none pr-10 bg-white">
                                     <option value="na">Ninguna</option>
                                    </select>
                            </div>
                        <div class="flex justify-between mt-8">
                             <button id="back-step-6-new-ref" class="btn-secondary flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás
                            </button>
                            <button id="next-step-6-new-ref" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">
                                Ver Estimación <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                        </div>
                    </div>

                    <div id="step-7-estimation" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6"><div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">7</div><h2 class="text-2xl font-bold text-gray-800">Estimación de Consumo Mensual</h2></div>
                        <div class="mb-6"><p class="text-gray-600 bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-400 font-medium"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Basado en los datos proporcionados y las tasas de uso estándar, el consumo mensual estimado es:</p></div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1"><div class="flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full mb-4 mx-auto"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg></div><h3 class="text-lg font-bold text-blue-800 text-center mb-2">Papel Higiénico</h3><div class="flex items-center justify-center"><p id="result-toilet-paper" class="text-3xl font-bold text-blue-900 text-center tracking-tight">-- cajas/mes</p></div><div class="mt-4 pt-3 border-t border-blue-200"><p class="text-xs text-blue-700 text-center font-medium">Consumo estimado basado en frecuencia de uso promedio</p></div></div>
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-5 rounded-xl border border-green-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1"><div class="flex items-center justify-center w-12 h-12 bg-green-600 text-white rounded-full mb-4 mx-auto"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" /></svg></div><h3 class="text-lg font-bold text-green-800 text-center mb-2">Toallas de Manos</h3><div class="flex items-center justify-center"><p id="result-hand-towels" class="text-3xl font-bold text-green-900 text-center tracking-tight">-- cajas/mes</p></div><div class="mt-4 pt-3 border-t border-green-200"><p class="text-xs text-green-700 text-center font-medium">Consumo estimado basado en frecuencia de uso promedio</p></div></div>
                            <div class="bg-gradient-to-br from-amber-50 to-yellow-50 p-5 rounded-xl border border-yellow-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1"><div class="flex items-center justify-center w-12 h-12 bg-amber-500 text-white rounded-full mb-4 mx-auto"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg></div><h3 class="text-lg font-bold text-amber-800 text-center mb-2">Jabón de Manos</h3><div class="flex items-center justify-center"><p id="result-hand-soap" class="text-3xl font-bold text-amber-900 text-center tracking-tight">-- cajas/mes</p></div><div class="mt-4 pt-3 border-t border-amber-200"><p class="text-xs text-amber-700 text-center font-medium">Consumo estimado basado en frecuencia de uso promedio</p></div></div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6"><div class="flex items-start"><div class="flex-shrink-0 mt-0.5"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg></div><p class="ml-3 text-sm text-gray-500">Cálculos basados en las horas y días laborales proporcionados y tasas de uso promedio. Estos valores pueden variar según los hábitos específicos de su equipo.</p></div></div>
                        <div class="flex justify-between mt-8">
                            <button id="back-step-7-est" class="btn-secondary flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás</button>
                            <button id="restartButtonNewLocation" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>Reiniciar Calculadora</button>
                        </div>
                    </div>
                </main>

                <aside class="chatbot-column hidden lg:flex flex-col bg-white p-4 rounded-lg shadow-sm border border-gray-100 self-start" style="min-height: 55vh;">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2 flex-shrink-0">Tork Data Driven</h3>
                    <div id="changing-stat-container" class="flex-grow flex items-center justify-center">

                        </div>
                    <div>
                        <script async
  src="https://ynfdil7dzfxg5dmvwrt6mu5t.agents.do-ai.run/static/chatbot/widget.js"
  data-agent-id="398ab7ba-2814-11f0-bf8f-4e013e2ddde4"
  data-chatbot-id="7XcaGsUlx-Ea-U4psyT_6IZPNaGrfi5N"
  data-name="Asesor TORK"
  data-primary-color="#031B4E"
  data-secondary-color="#E5E8ED"
  data-button-background-color="#0061EB"
  data-starting-message="¡Hola! Soy su asistente Tork. ¿En qué puedo ayudarle el dia de hoy?"
  data-logo="/static/chatbot/icons/default-agent.svg">
</script>
                    </div>
                </aside>
            </div>
        </div>
    </div

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    // --- Constantes, Tasas, Datos de Productos ---
    // WORK_HOURS_PER_WEEK and AVG_MONTHLY_WORK_HOURS are replaced by dynamic calculation from user input
    const WEEKS_PER_YEAR = 52; // Still potentially useful for other contexts, but not for primary monthly calc
    const MONTHS_PER_YEAR = 12;

    const RATES = {
        women: { toiletPaper: 0.38, handTowels: 0.25, handSoap: 0.44 }, // uses per person per hour
        men: { toiletPaper: 0.04, handTowels: 0.25, handSoap: 0.19 }    // uses per person per hour
    };

    const SIZE_DEFAULTS = {
        small: 30, medium: 125, large: 300
    };

    // --- Selectores de Elementos del DOM ---
    const steps = {
        step1: document.getElementById('step-1'),
        step2: document.getElementById('step-2'),
        step3: document.getElementById('step-3'), // New: Jornada Laboral
        step4: document.getElementById('step-4'), // Was Step 3 (Demografía)
        step5: document.getElementById('step-5'), // Was Step 4 (Tipos de Publico)
        step6NewReferences: document.getElementById('step-6-new-references'), // Was Step 5
        step7Estimation: document.getElementById('step-7-estimation')      // Was Step 6
    };
    const verticalNavSteps = document.querySelectorAll('.steps-nav li');
    const horizontalIndicators = {
        indicator1: document.getElementById('horizontal-step-indicator-1'),
        indicator2: document.getElementById('horizontal-step-indicator-2'),
        indicator3: document.getElementById('horizontal-step-indicator-3'), // New
        indicator4: document.getElementById('horizontal-step-indicator-4'),
        indicator5: document.getElementById('horizontal-step-indicator-5'),
        indicator6: document.getElementById('horizontal-step-indicator-6'),
        indicator7: document.getElementById('horizontal-step-indicator-7')
    };
    const buttons = {
        next1: document.getElementById('next-step-1'),
        back2: document.getElementById('back-step-2'), next2: document.getElementById('next-step-2'),
        back3: document.getElementById('back-step-3'), next3: document.getElementById('next-step-3'), // New
        back4: document.getElementById('back-step-4'), next4: document.getElementById('next-step-4'), // Was back3/next3
        back5: document.getElementById('back-step-5'), next5: document.getElementById('next-step-5'), // Was back4/next4
        back6NewRef: document.getElementById('back-step-6-new-ref'), // Was back5NewRef
        next6NewRef: document.getElementById('next-step-6-new-ref'), // Was next5NewRef
        back7Est: document.getElementById('back-step-7-est'),         // Was back6Est
        restart: document.getElementById('restartButtonNewLocation')
    };
    const inputs = {
        companySector: document.getElementById('companySector'),
        companySizeRadios: document.querySelectorAll('input[name="companySize"]'),
        manualEmployeeToggle: document.getElementById('manualEmployeeToggle'),
        manualEmployeeInputDiv: document.getElementById('manualEmployeeInputDiv'),
        exactEmployees: document.getElementById('exactEmployees'),
        daysWorkedPerMonth: document.getElementById('daysWorkedPerMonth'), // New
        hoursWorkedPerDay: document.getElementById('hoursWorkedPerDay'),   // New
        manualDemographicsToggle: document.getElementById('manualDemographicsToggle'),
        manualDemographicsInputDiv: document.getElementById('manualDemographicsInputDiv'),
        manualMen: document.getElementById('manualMen'), manualWomen: document.getElementById('manualWomen'),
        manualBathroomsToggle: document.getElementById('manualBathroomsToggle'),
        manualBathroomsInputDiv: document.getElementById('manualBathroomsInputDiv'),
        manualBathrooms: document.getElementById('manualBathrooms'),
        audienceAdministrative: document.getElementById('audienceAdministrative'),
        audienceOperative: document.getElementById('audienceOperative'),
        audienceFloating: document.getElementById('audienceFloating')
    };
    const displays = {
        estimatedMen: document.getElementById('estimatedMen'), estimatedWomen: document.getElementById('estimatedWomen'),
        estimatedBathrooms: document.getElementById('estimatedBathrooms'),
        totalEmployeesForAudience: document.getElementById('totalEmployeesForAudience'),
        resultToiletPaper: document.getElementById('result-toilet-paper'),
        resultHandTowels: document.getElementById('result-hand-towels'),
        resultHandSoap: document.getElementById('result-hand-soap')
    };
    const errors = {
        sectorError: document.getElementById('sectorError'),
        employeeError: document.getElementById('employeeError'),
        workHoursError: document.getElementById('workHoursError'), // New
        demographicsError: document.getElementById('demographicsError'),
        bathroomError: document.getElementById('bathroomError'),
        audienceError: document.getElementById('audienceError')
    };

    // --- Estado de la Aplicación ---
    let currentStep = 1;
    let companyData = {
        sector: null,
        totalEmployees: null,
        daysWorkedPerMonth: 20, // Default for new step
        hoursWorkedPerDay: 8,   // Default for new step
        men: null, women: null, bathrooms: null,
        audienceAdministrative: null, audienceOperative: null, audienceFloating: null,
        source: { employees: 'size', demographics: 'estimated', bathrooms: 'estimated' }, // Add source for work hours if needed
        calculationResults: { toiletPaper: 0, handTowels: 0, handSoap: 0 }
    };

    // --- Funciones de Utilidad (Calculadora) ---
    function updateStepIndicator() {
        verticalNavSteps.forEach((nav, index) => {
            nav.classList.remove('active', 'completed');
            if ((index + 1) === currentStep) nav.classList.add('active');
            else if ((index + 1) < currentStep) nav.classList.add('completed');
        });
        Object.values(horizontalIndicators).forEach((ind, index) => {
            if (ind) {
                const isActive = index + 1 === currentStep;
                const isCompleted = index + 1 < currentStep;
                ind.classList.toggle('step-active', isActive);
                ind.classList.toggle('step-completed', isCompleted);
                ind.classList.toggle('step-inactive', !isActive && !isCompleted);
                ind.classList.remove('bg-blue-600', 'text-white', 'bg-green-600', 'bg-gray-200', 'text-gray-600');
                if (isActive) ind.classList.add('bg-blue-600', 'text-white');
                else if (isCompleted) ind.classList.add('bg-green-600', 'text-white');
                else ind.classList.add('bg-gray-200', 'text-gray-600');
            }
        });
        Object.values(steps).forEach((stepContent, index) => {
            const isActive = index + 1 === currentStep;
            if (stepContent) {
                stepContent.classList.toggle('hidden', !isActive);
                if (isActive) {
                    stepContent.classList.remove('fade-leave-to', 'fade-leave-active', 'fade-enter-from');
                    stepContent.classList.add('fade-enter-active');
                } else {
                    stepContent.classList.remove('fade-enter-active');
                }
            }
        });
         window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function getSelectedCompanySize() {
        for (const radio of inputs.companySizeRadios) { if (radio.checked) return radio.value; } return null;
    }

    function calculateInferredData(totalEmployees) {
        if (!totalEmployees || totalEmployees <= 0) return { men: 0, women: 0, bathrooms: 0 };
        const inferredMen = Math.round(totalEmployees * 0.60);
        const inferredWomen = totalEmployees - inferredMen;
        const inferredBathrooms = Math.ceil(totalEmployees / 15);
        return { men: inferredMen, women: inferredWomen, bathrooms: inferredBathrooms };
    }

    function updateStep4_demographics_bathrooms_display() { // Was updateStep3Display
        const totalEmployees = companyData.totalEmployees;
        if (totalEmployees > 0) {
            const inferred = calculateInferredData(totalEmployees);
            displays.estimatedMen.textContent = inferred.men;
            displays.estimatedWomen.textContent = inferred.women;
            displays.estimatedBathrooms.textContent = inferred.bathrooms;

            if (companyData.source.demographics === 'manual') {
                inputs.manualMen.value = companyData.men ?? '';
                inputs.manualWomen.value = companyData.women ?? '';
            } else {
                inputs.manualMen.value = ''; inputs.manualWomen.value = '';
                companyData.men = inferred.men; companyData.women = inferred.women;
            }
            if (companyData.source.bathrooms === 'manual') {
                inputs.manualBathrooms.value = companyData.bathrooms ?? '';
            } else {
                inputs.manualBathrooms.value = '';
                companyData.bathrooms = inferred.bathrooms;
            }
        } else {
            displays.estimatedMen.textContent = '--'; displays.estimatedWomen.textContent = '--'; displays.estimatedBathrooms.textContent = '--';
            inputs.manualMen.value = ''; inputs.manualWomen.value = ''; inputs.manualBathrooms.value = '';
        }
    }

    function updateStep5_audience_display() { // Was updateStep4Display
        displays.totalEmployeesForAudience.textContent = companyData.totalEmployees > 0 ? companyData.totalEmployees : '--';
        inputs.audienceAdministrative.value = companyData.audienceAdministrative ?? '';
        inputs.audienceOperative.value = companyData.audienceOperative ?? '';
        inputs.audienceFloating.value = companyData.audienceFloating ?? '';
    }

    function calculateMonthlyUsage() {
        const men = companyData.men ?? 0;
        const women = companyData.women ?? 0;
        const daysWorked = companyData.daysWorkedPerMonth;
        const hoursPerDay = companyData.hoursWorkedPerDay;
        const totalMonthlyWorkHours = daysWorked * hoursPerDay;

        const toiletPaperUsage = (women * RATES.women.toiletPaper + men * RATES.men.toiletPaper) * totalMonthlyWorkHours;
        const handTowelsUsage = (women * RATES.women.handTowels + men * RATES.men.handTowels) * totalMonthlyWorkHours;
        const handSoapUsage = (women * RATES.women.handSoap + men * RATES.men.handSoap) * totalMonthlyWorkHours;
        const results = {
            toiletPaper: Math.round(toiletPaperUsage),
            handTowels: Math.round(handTowelsUsage),
            handSoap: Math.round(handSoapUsage)
        };
        companyData.calculationResults = results;
        return results;
    }

    function updateResultsDisplay(results) {
        displays.resultToiletPaper.textContent = `${results.toiletPaper.toLocaleString('es-CO')} cajas/mes`;
        displays.resultHandTowels.textContent = `${results.handTowels.toLocaleString('es-CO')} cajas/mes`;
        displays.resultHandSoap.textContent = `${results.handSoap.toLocaleString('es-CO')} cajas/mes`;
    }

    function hideAllErrors() {
        Object.values(errors).forEach(errorEl => errorEl.classList.add('hidden'));
    }

    function validateStep1() {
        hideAllErrors();
        if (!inputs.companySector.value) {
            errors.sectorError.classList.remove('hidden');
            inputs.companySector.focus();
            return false;
        }
        companyData.sector = inputs.companySector.value;
        return true;
    }

    function validateStep2() {
        hideAllErrors();
        const isManual = inputs.manualEmployeeToggle.checked;
        const exactValue = parseInt(inputs.exactEmployees.value, 10);
        const sizeSelected = getSelectedCompanySize();

        if (isManual) {
            if (!exactValue || exactValue <= 0 || exactValue < 11) {
                errors.employeeError.textContent = 'Por favor, ingresa un número válido de empleados (mínimo 11).';
                errors.employeeError.classList.remove('hidden');
                inputs.exactEmployees.focus();
                return false;
            }
            companyData.totalEmployees = exactValue;
            companyData.source.employees = 'manual';
        } else {
            if (!sizeSelected) {
                errors.employeeError.textContent = 'Por favor, selecciona un tamaño de empresa.';
                errors.employeeError.classList.remove('hidden');
                return false;
            }
            let representativeValue = SIZE_DEFAULTS[sizeSelected];
            if (sizeSelected === 'small' && representativeValue < 11) representativeValue = 11;
            companyData.totalEmployees = representativeValue;
            companyData.source.employees = 'size';
        }
        return true;
    }

    function validateStep3_workHours() { // New validation function
        hideAllErrors();
        const days = parseInt(inputs.daysWorkedPerMonth.value, 10);
        const hours = parseInt(inputs.hoursWorkedPerDay.value, 10);

        if (isNaN(days) || days < 1 || days > 31 || isNaN(hours) || hours < 1 || hours > 24) {
            errors.workHoursError.textContent = 'Ingresa un número válido de días (1-31) y horas (1-24).';
            errors.workHoursError.classList.remove('hidden');
            return false;
        }
        companyData.daysWorkedPerMonth = days;
        companyData.hoursWorkedPerDay = hours;
        return true;
    }


    function validateStep4_demographics_bathrooms() { // Was validateStep3
        hideAllErrors();
        let isValid = true;
        const totalEmployees = companyData.totalEmployees;
        if (!totalEmployees || totalEmployees <= 0) {
            return false;
        }

        if (inputs.manualDemographicsToggle.checked) {
            const manualMen = parseInt(inputs.manualMen.value, 10);
            const manualWomen = parseInt(inputs.manualWomen.value, 10);
            if (isNaN(manualMen) || manualMen < 0 || isNaN(manualWomen) || manualWomen < 0) {
                errors.demographicsError.textContent = 'Ingresa números válidos para hombres y mujeres.';
                errors.demographicsError.classList.remove('hidden'); isValid = false;
            } else if (manualMen + manualWomen !== totalEmployees) {
                errors.demographicsError.textContent = `La suma (${manualMen + manualWomen}) debe ser igual al total de empleados (${totalEmployees}).`;
                errors.demographicsError.classList.remove('hidden'); isValid = false;
            } else {
                companyData.men = manualMen; companyData.women = manualWomen;
                companyData.source.demographics = 'manual';
            }
        } else {
            const inferred = calculateInferredData(totalEmployees);
            companyData.men = inferred.men; companyData.women = inferred.women;
            companyData.source.demographics = 'estimated';
        }

        if (inputs.manualBathroomsToggle.checked) {
            const manualBathrooms = parseInt(inputs.manualBathrooms.value, 10);
            if (!manualBathrooms || manualBathrooms <= 0) {
                errors.bathroomError.textContent = 'Por favor, ingresa un número válido de baños (mínimo 1).';
                errors.bathroomError.classList.remove('hidden'); isValid = false;
            } else {
                companyData.bathrooms = manualBathrooms;
                companyData.source.bathrooms = 'manual';
            }
        } else {
            const inferred = calculateInferredData(totalEmployees);
            companyData.bathrooms = inferred.bathrooms;
            companyData.source.bathrooms = 'estimated';
        }
        return isValid;
    }

    function validateStep5_audience() { // Was validateStep4_audience
        hideAllErrors();
        const admin = parseInt(inputs.audienceAdministrative.value, 10);
        const operative = parseInt(inputs.audienceOperative.value, 10);
        const floating = parseInt(inputs.audienceFloating.value, 10);
        const totalEmployees = companyData.totalEmployees;

        if (isNaN(admin) || admin < 0 || isNaN(operative) || operative < 0 || isNaN(floating) || floating < 0) {
            errors.audienceError.textContent = 'Por favor, ingresa números válidos para cada tipo de público.';
            errors.audienceError.classList.remove('hidden');
            return false;
        }
        const sumAudienceForValidation = admin + operative;
        if (sumAudienceForValidation !== totalEmployees) {
            errors.audienceError.textContent = `La suma de Administrativos y Operativos (${sumAudienceForValidation}) debe ser igual al total de empleados (${totalEmployees}). Flotante es adicional.`;
            errors.audienceError.classList.remove('hidden');
            return false;
        }
        companyData.audienceAdministrative = admin;
        companyData.audienceOperative = operative;
        companyData.audienceFloating = floating;
        return true;
    }

    // --- Event Listeners (Calculadora) ---
    buttons.next1.addEventListener('click', () => {
        if (validateStep1()) {
            currentStep = 2; updateStepIndicator();
        }
    });

    inputs.manualEmployeeToggle.addEventListener('change', (e) => {
        const isChecked = e.target.checked;
        inputs.manualEmployeeInputDiv.classList.toggle('hidden', !isChecked);
        companyData.source.employees = isChecked ? 'manual' : 'size';
        hideAllErrors();
        if (isChecked) {
            inputs.companySizeRadios.forEach(radio => radio.checked = false);
            inputs.exactEmployees.value = ''; inputs.exactEmployees.focus();
        } else { inputs.exactEmployees.value = ''; }
    });
    inputs.companySizeRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            if (radio.checked) {
                inputs.manualEmployeeToggle.checked = false;
                inputs.manualEmployeeInputDiv.classList.add('hidden');
                inputs.exactEmployees.value = '';
                companyData.source.employees = 'size'; hideAllErrors();
            }
        });
    });
    buttons.back2.addEventListener('click', () => { currentStep = 1; updateStepIndicator(); hideAllErrors(); });
    buttons.next2.addEventListener('click', () => {
        if (validateStep2()) {
            // Pre-fill Step 3 (Jornada Laboral) defaults if needed, though they are set by 'value' attribute
            inputs.daysWorkedPerMonth.value = companyData.daysWorkedPerMonth;
            inputs.hoursWorkedPerDay.value = companyData.hoursWorkedPerDay;
            currentStep = 3; updateStepIndicator();
        }
    });

    // Step 3: Jornada Laboral (New)
    buttons.back3.addEventListener('click', () => { currentStep = 2; updateStepIndicator(); hideAllErrors(); });
    buttons.next3.addEventListener('click', () => {
        if (validateStep3_workHours()) {
            updateStep4_demographics_bathrooms_display(); // Prepare display for the next step
            currentStep = 4; updateStepIndicator();
        }
    });

    // Step 4: Demografía y Baños (Was Step 3)
    inputs.manualDemographicsToggle.addEventListener('change', (e) => {
        const isChecked = e.target.checked;
        inputs.manualDemographicsInputDiv.classList.toggle('hidden', !isChecked);
        companyData.source.demographics = isChecked ? 'manual' : 'estimated';
        hideAllErrors();
        if(isChecked) { inputs.manualMen.value = ''; inputs.manualWomen.value = ''; inputs.manualMen.focus(); }
        updateStep4_demographics_bathrooms_display();
    });
    inputs.manualBathroomsToggle.addEventListener('change', (e) => {
        const isChecked = e.target.checked;
        inputs.manualBathroomsInputDiv.classList.toggle('hidden', !isChecked);
        companyData.source.bathrooms = isChecked ? 'manual' : 'estimated';
        hideAllErrors();
        if(isChecked) { inputs.manualBathrooms.value = ''; inputs.manualBathrooms.focus(); }
         updateStep4_demographics_bathrooms_display();
    });
    buttons.back4.addEventListener('click', () => { currentStep = 3; updateStepIndicator(); hideAllErrors(); });
    buttons.next4.addEventListener('click', () => {
        if (validateStep4_demographics_bathrooms()) {
            updateStep5_audience_display(); // Prepare display for next step
            currentStep = 5; updateStepIndicator();
            inputs.audienceAdministrative.value= companyData.totalEmployees * 0.2
            inputs.audienceOperative.value = companyData.totalEmployees * 0.8
            inputs.audienceFloating.value = 0
        }
    });

    // Step 5: Tipos de Publico (Was Step 4)
    buttons.back5.addEventListener('click', () => { currentStep = 4; updateStepIndicator(); hideAllErrors(); });
    buttons.next5.addEventListener('click', () => { // "Calcular Consumo" button
        if (validateStep5_audience()) {
            calculateMonthlyUsage(); // Calculate based on internal rates and new work hours
            currentStep = 6; // Proceed to Seleccion de referencias
            updateStepIndicator();
        }
    });

    // Step 6: Seleccion de Referencias (Was Step 5)
    buttons.back6NewRef.addEventListener('click', () => { currentStep = 5; updateStepIndicator(); hideAllErrors(); });
    buttons.next6NewRef.addEventListener('click', () => { // "Ver Estimación" button
        calcularconsumo(companyData); // This will use API and also companyData.daysWorkedPerMonth, companyData.hoursWorkedPerDay
        currentStep = 7; // Proceed to Estimación Consumo
        updateStepIndicator();
    });

    // Step 7: Estimación Consumo (Was Step 6)
    buttons.back7Est.addEventListener('click', () => { currentStep = 6; updateStepIndicator(); hideAllErrors(); });
    buttons.restart.addEventListener('click', () => { location.reload(); });


    // --- Inicialización ---
    document.addEventListener('DOMContentLoaded', () => {
        updateStepIndicator();
        fillSelectsFromApiRefs(); // Call this here as well

        const statContainer = document.getElementById('changing-stat-container');
        const messages = [
            `<div class="stat-container"><div class="stat-number">97<span class="percentage">%</span></div><div class="stat-text">de clientes afirma que nuestro sistema<br>ayuda a mejorar la higiene<br>en sus instalaciones*</div></div>`,
            `<div class="stat-container"><div class="stat-number">85<span class="percentage">%</span></div><div class="stat-text">reporta una reducción<br>significativa en<br>el consumo*</div></div>`,
            `<div class="stat-container"><div class="stat-number">50<span class="percentage">%</span></div><div class="stat-text">menos tiempo dedicado<br>a rellenar<br>dispensadores*</div></div>`,
            `<div class="stat-container"><div class="stat-number">90<span class="percentage">%</span></div><div class="stat-text">está de acuerdo en que los<br>productos Tork son<br>de alta calidad*</div></div>`
        ];
        let currentMessageIndex = 0;
        function showNextMessage() {
            if (statContainer) {
                statContainer.innerHTML = messages[currentMessageIndex];
                currentMessageIndex = (currentMessageIndex + 1) % messages.length;
            }
        }
        if (statContainer) {
            showNextMessage();
            setInterval(showNextMessage, 7000);
        }

        let lastScrollTop = 0;
        const navbar = document.getElementById('autoHideNavbar');
        if (navbar) {
            window.addEventListener("scroll", function() {
                let currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                if (currentScroll > lastScrollTop && currentScroll > navbar.offsetHeight) {
                    navbar.style.top = `-${navbar.offsetHeight}px`;
                } else {
                    navbar.style.top = "0";
                }
                lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
            }, false);
        }
    });


async function fillSelectsFromApiRefs() {
  try {
    const response = await fetch('/api_refs');
    if (!response.ok) {
      throw new Error(`Error en la petición: ${response.status} ${response.statusText}`);
    }
    const data = await response.json();

    const phrefsSelect = document.getElementById('phrefs');
    if (phrefsSelect) {

      data.tplist.forEach(item => {
        const option = document.createElement('option');
        option.value = item.id;
        option.textContent = item.name;
        phrefsSelect.appendChild(option);
      });
    }

    const htrefsSelect = document.getElementById('htrefs');
    if (htrefsSelect) {

      data.htlist.forEach(item => {
        const option = document.createElement('option');
        option.value = item.id;
        option.textContent = item.name;
        htrefsSelect.appendChild(option);
      });
    }

    const srefsSelect = document.getElementById('srefs');
    if (srefsSelect) {

      data.slist.forEach(item => {
        const option = document.createElement('option');
        option.value = item.id;
        option.textContent = item.name;
        srefsSelect.appendChild(option);
      });
    }
  } catch (error) {
    console.error("Hubo un problema al llenar los selects:", error);
  }
}

 const phrefsSelect = document.getElementById('phrefs');
 const htrefsSelect = document.getElementById('htrefs');
 const srefsSelect = document.getElementById('srefs');

const calcularconsumo = async (companyData) => {
    const administrative = companyData.audienceAdministrative
    const operative = companyData.audienceOperative
    const floating = companyData.audienceFloating
    const menprop = companyData.totalEmployees > 0 ? companyData.men / companyData.totalEmployees : 0;
    const womenprop = companyData.totalEmployees > 0 ? companyData.women / companyData.totalEmployees : 0;
    let adcons, opcons, flcons;

    const baseFormData = {
        apikey: "asdklfLCJKVLvnclklskhdW09232dkja92235adj",
        sector: companyData.sector,
        diasLaborales: companyData.daysWorkedPerMonth, // Using new input
        horasLaborales: companyData.hoursWorkedPerDay, // Using new input
        tpref: phrefsSelect.value,
        htref: htrefsSelect.value,
        srref: "na",
        sref:  srefsSelect.value,
        lmref: "na",
    };

    const formDataAdminstrative = {
        ...baseFormData,
        numMujeres: womenprop * administrative,
        numHombres: menprop * administrative,
        tipoPublico: "Administrativo",
    };

    const formDataoperative = {
        ...baseFormData,
        numMujeres: womenprop * operative,
        numHombres: menprop * operative,
        tipoPublico: "Operativo",
    };

    const formDatafloating = {
        ...baseFormData,
        numMujeres: womenprop * floating, // Assuming floating population has similar gender distribution or this needs adjustment
        numHombres: menprop * floating,
        tipoPublico: "Flotante",
    };

  const finalcons = { consumoph: 0, consumojabon: 0, consumotoallas:0 };

  try {
    if (administrative > 0) {
        adcons = await fetch('/api_ce', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formDataAdminstrative)
        });
        if (adcons.ok) { const adconsres = await adcons.json(); finalcons.consumoph += adconsres.consumoph; finalcons.consumojabon += adconsres.consumojabon; finalcons.consumotoallas += adconsres.consumotoallas;}
        else { console.error("Error API Admin:", await adcons.text());}
    }

    if (operative > 0) {
        opcons = await fetch('/api_ce', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formDataoperative)
        });
        if (opcons.ok) { const opconsres = await opcons.json(); finalcons.consumoph += opconsres.consumoph; finalcons.consumojabon += opconsres.consumojabon; finalcons.consumotoallas += opconsres.consumotoallas;}
        else { console.error("Error API Operative:", await opcons.text());}
    }

    if (floating > 0) {
        flcons = await fetch('/api_ce', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formDatafloating)
        });
        if (flcons.ok) { const flconsres = await flcons.json(); finalcons.consumoph += flconsres.consumoph; finalcons.consumojabon += flconsres.consumojabon; finalcons.consumotoallas += flconsres.consumotoallas;}
        else { console.error("Error API Floating:", await flcons.text());}
    }
  } catch (error) {
      console.error("Error during API calls in calcularconsumo:", error);
  }

    companyData.calculationResults.toiletPaper = parseFloat(finalcons.consumoph.toFixed(2));
    companyData.calculationResults.handTowels = parseFloat(finalcons.consumotoallas.toFixed(2));
    // Assuming 'consumojabon' from API corresponds to 'handSoap' for display purposes
    // If 'servilletas' (napkins) should be 'resultHandSoap', this might be a mismatch.
    // For now, mapping 'consumojabon' to 'handSoap' display.
    companyData.calculationResults.handSoap = parseFloat(finalcons.consumojabon.toFixed(2));


    updateResultsDisplay(companyData.calculationResults);
}
    </script>


    </body>
</html>