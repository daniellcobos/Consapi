<!DOCTYPE html>
<html data-bs-theme="light" lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Smart Solutions - Simulador Tork</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i&amp;display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            padding-top: 80px; /* Ajuste para navbar fija */
        }
        .logo {
            font-weight: 600;
            color: #333;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: top 0.3s;
        }
        .main-grid {
            align-items: flex-start; /* Alinea los elementos al inicio */
        }
        .vertical-steps-indicator ul { list-style: none; padding-left: 0; }
        .vertical-steps-indicator .step {
            padding: 12px 15px; margin-bottom: 10px; border-radius: 8px;
            border: 1px solid #e5e7eb; transition: all 0.3s ease;
            display: flex; align-items: center; font-weight: 500; color: #4b5563;
        }
        .vertical-steps-indicator .step .step-number {
            display: inline-flex; align-items: center; justify-content: center;
            width: 28px; height: 28px; border-radius: 50%;
            background-color: #e5e7eb; color: #4b5563;
            font-weight: bold; margin-right: 12px; font-size: 0.9em;
        }
        .vertical-steps-indicator .step.active {
            background-color: #eff6ff; border-color: #60a5fa; color: #1d4ed8;
        }
        .vertical-steps-indicator .step.active .step-number {
            background-color: #3b82f6; color: white;
        }
        .vertical-steps-indicator .step.completed {
            background-color: #f0fdf4; border-color: #86efac; color: #166534;
        }
        .vertical-steps-indicator .step.completed .step-number {
            background-color: #22c55e; color: white;
        }
        .step-content {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .fade-enter-active { opacity: 1; transform: translateY(0); }
        .fade-enter-from { opacity: 0; transform: translateY(20px); }
        .btn-secondary {
            padding: 0.75rem 1.5rem; background-color: #6b7280; color: white;
            font-weight: 500; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        .btn-secondary:hover { background-color: #4b5563; transform: translateY(-1px); }
        .btn-disabled { background-color: #9ca3af !important; cursor: not-allowed !important; }
        .product-card {
            padding: 1.5rem; border-radius: 0.75rem; border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -1px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
        }
        .product-card:hover { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -2px rgba(0,0,0,0.03); transform: translateY(-2px); }

        /* Estilos para layout de producto en 2 columnas */
        .recommendation-layout { display: flex; flex-direction: column; gap: 1rem; }
        @media (min-width: 768px) { /* md breakpoint */
            .recommendation-layout { flex-direction: row; gap: 1.5rem; }
        }
        .image-column { flex: 0 0 auto; width: 100%; max-width: 200px; margin: auto; }
        @media (min-width: 768px) { .image-column { width: 150px; margin: 0; } }
        .product-image { width: 100%; height: auto; object-fit: contain; border-radius: 0.5rem; border: 1px solid #e5e7eb; background-color: white; padding: 0.5rem; }
        .text-column { flex: 1 1 auto; }
        .product-title { font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem; }
        .details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.5rem 1rem; font-size: 0.875rem; color: #4b5563; margin-bottom: 1rem; }
        .details-grid p span:first-child { color: #6b7280; }
        .calculated-values p { font-size: 0.9rem; margin-bottom: 0.5rem; padding: 0.5rem; background-color: #f9fafb; border-radius: 0.375rem; border: 1px solid #f3f4f6; }
        .calculated-values .value, .calculated-values .price-value, .calculated-values .outlay-value { font-weight: 600; color: #1e40af; }
        .calculated-values .usage-context { font-size: 0.8rem; color: #6b7280; }
        .stat-container { text-align: center; padding: 1rem; }
        .stat-number { font-size: 3rem; font-weight: bold; color: #1d4ed8; line-height: 1; }
        .stat-number .percentage { font-size: 1.5rem; vertical-align: super; }
        .stat-text { font-size: 0.9rem; color: #4b5563; margin-top: 0.5rem; }
    </style>
</head>

<body>

    <nav id="autoHideNavbar" class="navbar navbar-light fixed-top" style="background-color:#ffffff;">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand logo fs-5 d-flex align-items-center" href="#">
                <img src="https://essity-images.essity.com/images-c5/63/169063/optimized-w1440_jpg/tork-logo-blue-cmyk.jpg?w=1080&h=100000&imPolicy=dynamic" alt="Tork Vision Logo" class="me-2" width="60" height="40" onerror="this.style.display='none'">
                Smart Solutions
            </a>
            <h1 class="fs-5 fw-bold text-center d-none d-md-block" style="font-size: larger;">Simulador de Consumo Mensual Institucional ¡en solo 7 pasos!</h1>
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" type="button" id="externalLinksDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Saber más...
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="externalLinksDropdown">
                    <li><a class="dropdown-item" href="https://familiainstitucional.com/blog/familia-institucional-ahora-es-tork" target="_blank">¿Por qué Tork?</a></li>
                    <li><a class="dropdown-item" href="https://www.cuidateenfamilia.com/productos-tork" target="_blank">Catálogo de productos</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="https://www.tork.com/contacto" target="_blank">Contacto</a></li>
                    <li><a class="dropdown-item" href="https://www.tork.com/soporte" target="_blank">Soporte técnico</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="bg-gray-50 p-4 md:p-8 min-h-screen">
        <div class="max-w-screen-2xl mx-auto">
            <div class="horizontal-steps-indicator flex justify-center items-center space-x-1 md:space-x-2 mb-8 md:hidden">
                <div id="horizontal-step-indicator-1" class="step-indicator step-active w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-blue-600 text-white">1</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-2" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">2</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-3" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">3</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-4" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">4</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-5" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">5</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-6" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">6</div>
                <div class="h-1 w-4 md:w-8 bg-gray-300 rounded"></div>
                <div id="horizontal-step-indicator-7" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs md:text-sm bg-gray-200 text-gray-600">7</div>
            </div>

            <div class="main-grid grid grid-cols-1 lg:grid-cols-[280px_1fr_350px] gap-6 md:gap-8">
                <aside class="vertical-steps-indicator hidden md:block bg-white p-4 rounded-lg shadow-sm border border-gray-100 self-start" style="min-height: 55vh;">
                    <nav class="steps-nav">
                        <ul>
                            <li id="nav-step-1" class="step active"><span class="step-number">1</span> Sector Empresa</li>
                            <li id="nav-step-2" class="step"><span class="step-number">2</span> Tamaño Empresa</li>
                            <li id="nav-step-3" class="step"><span class="step-number">3</span> Demografía y Baños</li>
                            <li id="nav-step-4" class="step"><span class="step-number">4</span> Tipos de Publico</li>
                            <li id="nav-step-5" class="step"><span class="step-number">5</span> Estimación Consumo</li>
                            <li id="nav-step-6" class="step"><span class="step-number">6</span> Mezcla Segmentos</li>
                            <li id="nav-step-7" class="step"><span class="step-number">7</span> Recomendación</li>
                        </ul>
                    </nav>
                </aside>

                <main id="form-container">
                    <div id="step-1" class="step-content fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6">
                            <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">1</div>
                            <h2 class="text-2xl font-bold text-gray-800">Sector de la Empresa</h2>
                        </div>
                        <div class="space-y-5 mb-8">
                            <p class="text-gray-600 font-medium">Selecciona el sector al que pertenece tu empresa:</p>
                            <div>
                                <label for="companySector" class="block text-sm font-medium text-gray-700 mb-2">Sector:</label>
                                <div class="relative">
                                    <select id="companySector" name="companySector" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 appearance-none pr-10 bg-white">
                                        <option value="" disabled selected>-- Selecciona un sector --</option>
                                        <option value="oficinas">Oficinas / Corporativo</option>
                                        <option value="industria">Industria / Manufactura</option>
                                        <option value="salud">Salud (Hospitales, Clínicas)</option>
                                        <option value="educacion">Educación (Colegios, Universidades)</option>
                                        <option value="horeca">HoReCa (Hoteles, Restaurantes, Cafeterías)</option>
                                        <option value="retail">Retail / Comercio</option>
                                        <option value="publico">Sector Público / Gobierno</option>
                                        <option value="otro">Otro</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                                <p id="sectorError" class="text-red-500 text-sm mt-2 hidden">Por favor, selecciona un sector.</p>
                            </div>
                        </div>
                        <div class="flex justify-end mt-8">
                            <button id="next-step-1" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">
                                Siguiente <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>

                    <div id="step-2" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6">
                            <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">2</div>
                            <h2 class="text-2xl font-bold text-gray-800">Tamaño de la Empresa</h2>
                        </div>
                        <div class="space-y-5 mb-8">
                            <p class="text-gray-600 font-medium">Selecciona el tamaño de la empresa o ingresa el número exacto de empleados:</p>
                            <div class="grid gap-3">
                                <label class="relative flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-indigo-500 cursor-pointer transition-all duration-200 group">
                                    <input type="radio" name="companySize" value="small" class="peer sr-only">
                                    <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-4 transition-all duration-200 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 group-hover:border-indigo-400"><div class="w-3 h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100"></div></div>
                                    <div><span class="font-medium text-gray-800">Pequeña</span><p class="text-sm text-gray-500">11-50 empleados</p></div>
                                </label>
                                <label class="relative flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-indigo-500 cursor-pointer transition-all duration-200 group">
                                    <input type="radio" name="companySize" value="medium" class="peer sr-only">
                                    <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-4 transition-all duration-200 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 group-hover:border-indigo-400"><div class="w-3 h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100"></div></div>
                                    <div><span class="font-medium text-gray-800">Mediana</span><p class="text-sm text-gray-500">51-200 empleados</p></div>
                                </label>
                                <label class="relative flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-indigo-500 cursor-pointer transition-all duration-200 group">
                                    <input type="radio" name="companySize" value="large" class="peer sr-only" checked> <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-4 transition-all duration-200 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 group-hover:border-indigo-400"><div class="w-3 h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100"></div></div>
                                    <div><span class="font-medium text-gray-800">Grande</span><p class="text-sm text-gray-500">Más de 200 empleados</p></div>
                                </label>
                            </div>
                            <div class="flex items-center mt-6 border-t pt-4 border-gray-100">
                                <label class="relative inline-flex cursor-pointer items-center group">
                                    <input type="checkbox" id="manualEmployeeToggle" class="peer sr-only">
                                    <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                    <span class="ml-3 text-gray-700 cursor-pointer font-medium">Ingresar número exacto</span>
                                </label>
                            </div>
                            <div id="manualEmployeeInputDiv" class="hidden mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <label for="exactEmployees" class="block text-sm font-medium text-gray-700 mb-2">Número Exacto de Empleados:</label>
                                <div class="relative">
                                    <input type="number" id="exactEmployees" name="exactEmployees" min="1" class="w-full p-3 pr-12 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 75">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg></div>
                                </div>
                                <p id="employeeError" class="text-red-500 text-sm mt-2 hidden">Por favor, ingresa un número válido de empleados.</p>
                            </div>
                        </div>
                        <div class="flex justify-between mt-8">
                             <button id="back-step-2" class="btn-secondary flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás
                            </button>
                            <button id="next-step-2" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">
                                Siguiente <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>

                    <div id="step-3" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                         <div class="flex items-center mb-6">
                             <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">3</div>
                             <h2 class="text-2xl font-bold text-gray-800">Demografía y Baños</h2>
                         </div>
                         <div class="space-y-8">
                             <div class="bg-gray-50 rounded-lg p-5 border border-gray-200">
                                 <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-600" viewBox="0 0 20 20" fill="currentColor"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" /></svg>Distribución de Empleados</h3>
                                 <p class="text-gray-600 mb-4">El sistema estima la siguiente distribución (60% hombres, 40% mujeres). Puedes ajustarla si es necesario.</p>
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-5">
                                     <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm"><label class="block text-sm font-medium text-gray-500">Hombres (Estimado)</label><div class="flex items-center mt-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg><p id="estimatedMen" class="text-xl font-bold text-gray-900">--</p></div></div>
                                     <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm"><label class="block text-sm font-medium text-gray-500">Mujeres (Estimado)</label><div class="flex items-center mt-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg><p id="estimatedWomen" class="text-xl font-bold text-gray-900">--</p></div></div>
                                 </div>
                                 <div class="flex items-center mt-4"><label class="relative inline-flex cursor-pointer items-center group"><input type="checkbox" id="manualDemographicsToggle" class="peer sr-only"><div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div><span class="ml-3 text-gray-700 cursor-pointer font-medium">Ingresar números manualmente</span></label></div>
                                 <div id="manualDemographicsInputDiv" class="hidden mt-5 grid grid-cols-1 md:grid-cols-2 gap-5">
                                     <div class="relative"><label for="manualMen" class="block text-sm font-medium text-gray-700 mb-2">Número de Hombres:</label><div class="relative"><input type="number" id="manualMen" name="manualMen" min="0" class="w-full p-3 pl-10 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 30"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg></div></div></div>
                                     <div class="relative"><label for="manualWomen" class="block text-sm font-medium text-gray-700 mb-2">Número de Mujeres:</label><div class="relative"><input type="number" id="manualWomen" name="manualWomen" min="0" class="w-full p-3 pl-10 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 20"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg></div></div></div>
                                 </div>
                                 <p id="demographicsError" class="text-red-500 text-sm mt-3 hidden bg-red-50 p-2 rounded-lg border border-red-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>La suma de hombres y mujeres debe ser igual al total de empleados.</p>
                             </div>
                             <div class="bg-gray-50 rounded-lg p-5 border border-gray-200">
                                 <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clip-rule="evenodd" /></svg>Instalaciones</h3>
                                 <p class="text-gray-600 mb-4">El sistema estima el número de baños necesarios (1 por cada 15 empleados, de acuerdo a la normatividad Colombiana). Puede ajustarlo.</p>
                                 <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm mb-5 w-full md:w-1/2"><label class="block text-sm font-medium text-gray-500">Baños (Estimado)</label><div class="flex items-center mt-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-teal-600 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg><p id="estimatedBathrooms" class="text-xl font-bold text-gray-900">--</p></div></div>
                                 <div class="flex items-center mt-4"><label class="relative inline-flex cursor-pointer items-center group"><input type="checkbox" id="manualBathroomsToggle" class="peer sr-only"><div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div><span class="ml-3 text-gray-700 cursor-pointer font-medium">Ingresar número manualmente</span></label></div>
                                 <div id="manualBathroomsInputDiv" class="hidden mt-5"><div class="relative w-full md:w-1/2"><label for="manualBathrooms" class="block text-sm font-medium text-gray-700 mb-2">Número de Baños:</label><div class="relative"><input type="number" id="manualBathrooms" name="manualBathrooms" min="1" class="w-full p-3 pl-10 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 5"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-teal-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg></div></div><p id="bathroomError" class="text-red-500 text-sm mt-3 hidden bg-red-50 p-2 rounded-lg border border-red-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>Por favor, ingresa un número válido de baños.</p></div></div>
                             </div>
                         </div>
                         <div class="flex justify-between mt-8">
                             <button id="back-step-3" class="btn-secondary flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás</button>
                             <button id="next-step-3" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">Siguiente <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>
                         </div>
                    </div>

                    <div id="step-4" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6">
                            <div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">4</div>
                            <h2 class="text-2xl font-bold text-gray-800">Tipos de Público</h2>
                        </div>
                        <div class="space-y-5 mb-8">
                            <p class="text-gray-600 font-medium">Ingresa la cantidad de personas para cada tipo de público. La suma de Administrativos y Flotantes debe ser igual al total de empleados (<span id="totalEmployeesForAudience" class="font-bold">--</span>).</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="audienceAdministrative" class="block text-sm font-medium text-gray-700 mb-1">Administrativo:</label>
                                    <input type="number" id="audienceAdministrative" name="audienceAdministrative" min="0" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 25">
                                </div>
                                <div>
                                    <label for="audienceOperative" class="block text-sm font-medium text-gray-700 mb-1">Operativo:</label>
                                    <input type="number" id="audienceOperative" name="audienceOperative" min="0" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 50">
                                </div>
                                <div>
                                    <label for="audienceFloating" class="block text-sm font-medium text-gray-700 mb-1">Flotante:</label>
                                    <input type="number" id="audienceFloating" name="audienceFloating" min="0" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Ej: 10">
                                </div>
                            </div>
                             <p id="audienceError" class="text-red-500 text-sm mt-3 hidden bg-red-50 p-2 rounded-lg border border-red-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>Error en la distribución del público.</p>
                        </div>
                        <div class="flex justify-between mt-8">
                            <button id="back-step-4" class="btn-secondary flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás
                           </button>
                           <button id="next-step-4" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">
                                Calcular Consumo <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm2 10a1 1 0 10-2 0v3a1 1 0 102 0v-3zm2-3a1 1 0 011 1v5a1 1 0 11-2 0v-5a1 1 0 011-1zm4-1a1 1 0 10-2 0v7a1 1 0 102 0V8z" clip-rule="evenodd" /></svg>
                           </button>
                        </div>
                    </div>

                    <div id="step-5" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6"><div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">5</div><h2 class="text-2xl font-bold text-gray-800">Estimación de Consumo Mensual</h2></div>
                        <div class="mb-6"><p class="text-gray-600 bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-400 font-medium"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Basado en los datos proporcionados y las tasas de uso estándar, el consumo mensual estimado es:</p></div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1"><div class="flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full mb-4 mx-auto"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg></div><h3 class="text-lg font-bold text-blue-800 text-center mb-2">Papel Higiénico</h3><div class="flex items-center justify-center"><p id="result-toilet-paper" class="text-3xl font-bold text-blue-900 text-center tracking-tight">-- usos/mes</p></div><div class="mt-4 pt-3 border-t border-blue-200"><p class="text-xs text-blue-700 text-center font-medium">Consumo estimado basado en frecuencia de uso promedio</p></div></div>
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-5 rounded-xl border border-green-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1"><div class="flex items-center justify-center w-12 h-12 bg-green-600 text-white rounded-full mb-4 mx-auto"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" /></svg></div><h3 class="text-lg font-bold text-green-800 text-center mb-2">Toallas de Manos</h3><div class="flex items-center justify-center"><p id="result-hand-towels" class="text-3xl font-bold text-green-900 text-center tracking-tight">-- usos/mes</p></div><div class="mt-4 pt-3 border-t border-green-200"><p class="text-xs text-green-700 text-center font-medium">Consumo estimado basado en frecuencia de uso promedio</p></div></div>
                            <div class="bg-gradient-to-br from-amber-50 to-yellow-50 p-5 rounded-xl border border-yellow-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1"><div class="flex items-center justify-center w-12 h-12 bg-amber-500 text-white rounded-full mb-4 mx-auto"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg></div><h3 class="text-lg font-bold text-amber-800 text-center mb-2">Jabón de Manos</h3><div class="flex items-center justify-center"><p id="result-hand-soap" class="text-3xl font-bold text-amber-900 text-center tracking-tight">-- usos/mes</p></div><div class="mt-4 pt-3 border-t border-amber-200"><p class="text-xs text-amber-700 text-center font-medium">Consumo estimado basado en frecuencia de uso promedio</p></div></div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6"><div class="flex items-start"><div class="flex-shrink-0 mt-0.5"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg></div><p class="ml-3 text-sm text-gray-500">Cálculos basados en una semana laboral de 42 horas y tasas de uso promedio por hora. Estos valores pueden variar según los hábitos específicos de su equipo.</p></div></div>
                        <div class="flex justify-between mt-8">
                            <button id="back-step-5" class="btn-secondary flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás</button>
                            <button id="next-step-5" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">Siguiente<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>
                        </div>
                    </div>

                    <div id="step-6" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                         <div class="flex items-center mb-6"><div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">6</div><h2 class="text-2xl font-bold text-gray-800">Selección de Mezcla de Segmentos</h2></div>
                         <p class="text-gray-600 mb-4">Define la distribución porcentual deseada entre los segmentos de productos. La suma debe ser 100%.</p>
                         <div class="overflow-x-auto mb-6 rounded-lg border border-gray-200">
                             <table class="w-full text-sm text-left text-gray-500"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th scope="col" class="px-6 py-3 whitespace-nowrap">SEGMENTO</th><th scope="col" class="px-6 py-3 whitespace-nowrap bg-indigo-50 text-indigo-800 font-semibold">TORK (Recomendado)</th><th scope="col" class="px-6 py-3 whitespace-nowrap">KCP</th><th scope="col" class="px-6 py-3 whitespace-nowrap">ELITE</th></tr></thead><tbody><tr class="bg-white border-b hover:bg-gray-50"><td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">BUSCA PRECIO</td><td class="px-6 py-4 bg-indigo-50 text-indigo-700">UNIVERSAL</td><td class="px-6 py-4">SCOTT BASIC</td><td class="px-6 py-4">CLASIC</td></tr><tr class="bg-white border-b hover:bg-gray-50"><td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">BUSCA CALIDAD</td><td class="px-6 py-4 bg-indigo-50 text-indigo-700">ADVANCED</td><td class="px-6 py-4">SCOTT ESENTIAL DISEÑO y RENDIMIENTO</td><td class="px-6 py-4">PLUS</td></tr><tr class="bg-white hover:bg-gray-50"><td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">BUSCA CALIDAD Y CONFORT</td><td class="px-6 py-4 bg-indigo-50 text-indigo-700">PREMIUM</td><td class="px-6 py-4">SCOTT ESENTIAL FLUJO CENTRAL</td><td class="px-6 py-4">EXCELLENCE</td></tr></tbody></table>
                         </div>
                         <div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded-lg mb-6 text-sm shadow-sm"><h4 class="font-semibold mb-1">Ventaja del Portafolio TORK:</h4><p>Generalmente, el portafolio TORK ofrece mayor eficiencia en comparación con:</p><ul class="list-disc list-inside ml-4 mt-1 space-y-1"><li>KCP: Entre un <strong>4% y 8%</strong> más eficiente.</li><li>Elite: Entre un <strong>6% y 15%</strong> más eficiente.</li></ul></div>
                         <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-4">
                              <div><label for="percentBuscaPrecio" class="block text-sm font-medium text-gray-700 mb-1">Busca Precio (%)</label><input type="number" id="percentBuscaPrecio" name="percentBuscaPrecio" min="0" max="100" value="30" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-center text-lg font-medium segment-percent transition duration-150 ease-in-out"></div>
                              <div><label for="percentBuscaCalidad" class="block text-sm font-medium text-gray-700 mb-1">Busca Calidad (%)</label><input type="number" id="percentBuscaCalidad" name="percentBuscaCalidad" min="0" max="100" value="50" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-center text-lg font-medium segment-percent transition duration-150 ease-in-out"></div>
                              <div><label for="percentBuscaConfort" class="block text-sm font-medium text-gray-700 mb-1">Busca Calidad y Confort (%)</label><input type="number" id="percentBuscaConfort" name="percentBuscaConfort" min="0" max="100" value="20" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-center text-lg font-medium segment-percent transition duration-150 ease-in-out"></div>
                         </div>
                         <div class="text-right mb-8 mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200"><span id="percentTotal" class="text-lg font-bold text-indigo-700">Total: 100%</span><p id="percentError" class="text-red-600 text-sm mt-1 hidden font-medium">La suma de los porcentajes debe ser 100%.</p></div>
                         <div class="flex justify-between mt-8">
                            <button id="back-step-6" class="btn-secondary flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás</button>
                            <button id="next-step-6" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center">Ver Recomendación<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>
                         </div>
                    </div>

                    <div id="step-7" class="step-content hidden fade-enter-active vertical-steps-indicator bg-white p-6 rounded-xl shadow-lg border border-gray-100 self-start">
                        <div class="flex items-center mb-6"><div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-semibold mr-3">7</div><h2 class="text-2xl font-bold text-gray-800">Recomendación de Productos Tork</h2></div>
                        <p class="text-gray-600 mb-6 bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-400 font-medium"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Basado en tu mezcla de segmentos seleccionada y el consumo estimado, te recomendamos la siguiente combinación de productos Tork:</p>
                        <div id="product-recommendation-list" class="space-y-6">
                            <div class="product-card bg-gradient-to-br from-blue-50 to-indigo-50">
                                <div class="flex items-center mb-4"> <div class="flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center mr-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                                </div>
                                <h3 class="text-lg font-semibold text-blue-800">Papel Higiénico Recomendado</h3>
                                </div>
                                <div id="recommended-toilet-paper" class="recommendation-content">
                                    <p class="italic">Calculando...</p>
                                </div>
                            </div>
                            <div class="product-card bg-gradient-to-br from-green-50 to-emerald-50">
                                <div class="flex items-center mb-4"> <div class="flex-shrink-0 w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center mr-3">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" /></svg>
                                </div>
                                <h3 class="text-lg font-semibold text-green-800">Toalla de Manos Recomendada</h3>
                                </div>
                                <div id="recommended-hand-towel" class="recommendation-content">
                                    <p class="italic">Calculando...</p>
                                </div>
                            </div>
                            <div class="product-card bg-gradient-to-br from-amber-50 to-yellow-50">
                                <div class="flex items-center mb-4"> <div class="flex-shrink-0 w-10 h-10 bg-amber-500 text-white rounded-full flex items-center justify-center mr-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
                                </div>
                                <h3 class="text-lg font-semibold text-amber-800">Jabón de Manos Recomendado</h3>
                                </div>
                                <div id="recommended-hand-soap" class="recommendation-content">
                                    <p class="italic">Calculando...</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between mt-8 pt-6 border-t border-gray-200">
                            <button id="back-step-7" class="btn-secondary flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>Atrás</button>
                            <button id="restartButton" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>Reiniciar Calculadora</button>
                        </div>
                    </div>
                </main>

                <aside class="chatbot-column hidden lg:flex flex-col bg-white p-4 rounded-lg shadow-sm border border-gray-100 self-start" style="min-height: 55vh;">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2 flex-shrink-0">Tork Data Driven</h3>
                    <div id="changing-stat-container" class="flex-grow flex items-center justify-center">
                        </div>
                </aside>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    // --- Constantes, Tasas, Datos de Productos ---
    const WORK_HOURS_PER_WEEK = 42;
    const WEEKS_PER_YEAR = 52;
    const MONTHS_PER_YEAR = 12;
    const AVG_MONTHLY_WORK_HOURS = (WORK_HOURS_PER_WEEK * WEEKS_PER_YEAR) / MONTHS_PER_YEAR; // Aprox 182

    const RATES = {
        women: { toiletPaper: 0.38, handTowels: 0.25, handSoap: 0.44 },
        men: { toiletPaper: 0.04, handTowels: 0.25, handSoap: 0.19 }
    };

    const SIZE_DEFAULTS = {
        small: 30, medium: 125, large: 300
    };

    const torkProducts = {
        papelHigienico: [
            { codigo: '71610', descripcion: 'Tork SmartOne® Papel Higiénico', metros: 200, hojas: 2, color: 'Blanco', calidad: 'Universal', papel: 'Precortado', rollosXPaca: 4, dispensador: '83,700', precioUnitario: 55000, imagenURL: 'https://cefco.vtexassets.com/arquivos/ids/156992-1200-auto?v=638599444322570000&width=1200&height=auto&aspect=true' },
            { codigo: '71613', descripcion: 'Tork SmartOne® Papel Higiénico', metros: 200, hojas: 2, color: 'Natural', calidad: 'Universal', papel: 'Precortado', rollosXPaca: 4, dispensador: '83,700', precioUnitario: 52000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/bath-tissue/71613_tork_smartone_toilet_roll_natural.png?width=1000' },
            { codigo: '71611', descripcion: 'Tork SmartOne® Mini Papel Higiénico', metros: 100, hojas: 2, color: 'Blanco', calidad: 'Universal', papel: 'Precortado', rollosXPaca: 12, dispensador: '83,701', precioUnitario: 75000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/bath-tissue/71611_tork_smartone_mini_toilet_roll_white.png?width=1000' },
            { codigo: '71612', descripcion: 'Tork SmartOne® Mini Papel Higiénico', metros: 100, hojas: 2, color: 'Natural', calidad: 'Advanced', papel: 'Precortado', rollosXPaca: '2x6', dispensador: '83,701', precioUnitario: 85000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/bath-tissue/71612_tork_smartone_mini_toilet_roll_natural.png?width=1000' },
            { codigo: '71157', descripcion: 'Tork® Papel Higiénico Jumbo', metros: 250, hojas: 2, color: 'Blanco', calidad: 'Advanced', papel: 'Continuo', rollosXPaca: 4, dispensador: '201,588', precioUnitario: 65000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/bath-tissue/71157_tork_jumbo_toilet_roll_advanced_white.png?width=1000' },
            { codigo: '71457', descripcion: 'Tork® Papel Higiénico Jumbo', metros: 250, hojas: 2, color: 'Natural', calidad: 'Advanced', papel: 'Continuo', rollosXPaca: 4, dispensador: '201,588', precioUnitario: 62000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/bath-tissue/71457_tork_jumbo_toilet_roll_advanced_natural.png?width=1000' },
        ],
        toallasManos: [
            { codigo: '73575', descripcion: 'Tork® Toalla de Manos Flujo Central', metros: 100, hojas: 3, color: 'Blanco', calidad: 'Universal', papel: 'Precortada', rollosXPaca: '6', dispensador: '83160 / M5', precioUnitario: 90000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/hand-towels/73575_tork_centrefeed_towel_universal_white.png?width=1000' },
            { codigo: '73689', descripcion: 'Tork® Toalla de Manos Flujo Central', metros: 100, hojas: 3, color: 'Natural', calidad: 'Universal', papel: 'Precortada', rollosXPaca: '6', dispensador: '83160 / M5', precioUnitario: 85000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/hand-towels/73689_tork_centrefeed_towel_universal_natural.png?width=1000' },
            { codigo: '73686', descripcion: 'Tork® Toalla de Manos Flujo Central', metros: 100, hojas: 3, color: 'Natural', calidad: 'Advanced', papel: 'Precortada', rollosXPaca: '6', dispensador: '83160 / M5', precioUnitario: 95000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/hand-towels/73686_tork_centrefeed_towel_advanced_natural.png?width=1000' },
            { codigo: '290059', descripcion: 'Tork Matic® Toalla de Manos en Rollo Premium', metros: 100, hojas: 2, color: 'Blanco', calidad: 'Premium', papel: 'Continuo (Matic)', rollosXPaca: 6, dispensador: 'H1', precioUnitario: 110000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/paper/hand-towels/290059_tork_matic_hand_towel_roll_premium_white.png?width=1000' },
        ],
        jabonManos: [
            { codigo: '80541', descripcion: 'Tork® Jabón en Espuma Antibacterial para Manos', volumen: '1.000 ml', tipo: 'Antibacterial', calidad: 'Universal', extra: 'NA', paca: 6, dispensador: '83530 - 83620', precioUnitario: 150000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/skin-care/soap/80541_tork_antibacterial_foam_soap.png?width=1000' },
            { codigo: '80506', descripcion: 'Tork® Jabón Líquido para Manos', volumen: '1.000 ml', tipo: 'Suave', calidad: 'Universal', extra: 'NA', paca: 6, dispensador: '83510', precioUnitario: 120000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/skin-care/soap/80506_tork_mild_liquid_soap.png?width=1000' },
            { codigo: '80550', descripcion: 'Tork® Jabón mini Liquido para Manos', volumen: '475 ml', tipo: 'Suave', calidad: 'Advanced', extra: 'NA', paca: 8, dispensador: '83550', precioUnitario: 100000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/skin-care/soap/80550_tork_mild_mini_liquid_soap.png?width=1000' },
            { codigo: '80530', descripcion: 'Tork® Jabón en espuma para Manos', volumen: '1.000 ml', tipo: 'Suave', calidad: 'Premium', extra: 'NA', paca: 6, dispensador: '83530 - 83620', precioUnitario: 160000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/skin-care/soap/80530_tork_mild_foam_soap.png?width=1000' },
            { codigo: '80510', descripcion: 'Tork® Jabón Liquido Extra Higiene para Manos', volumen: '1.000 ml', tipo: 'Limpieza Profunda', calidad: 'Premium', extra: 'NA', paca: 6, dispensador: '83510', precioUnitario: 140000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/skin-care/soap/80510_tork_extra_hygiene_liquid_soap.png?width=1000' },
            { codigo: '80560', descripcion: 'Tork® Jabón mini para Cabello y Cuerpo', volumen: '475 ml', tipo: 'Suave', calidad: 'Premium', extra: 'NA', paca: 8, dispensador: '83550', precioUnitario: 110000, imagenURL: 'https://www.tork.com.co/globalassets/tork-products/skin-care/soap/80560_tork_hair__body_mini_liquid_soap.png?width=1000' },
        ]
    };
    const qualityMapping = { buscaPrecio: 'Universal', buscaCalidad: 'Advanced', buscaConfort: 'Premium' };

    // --- Selectores de Elementos del DOM ---
    const steps = {
        step1: document.getElementById('step-1'), step2: document.getElementById('step-2'),
        step3: document.getElementById('step-3'), step4: document.getElementById('step-4'), // New step
        step5: document.getElementById('step-5'), step6: document.getElementById('step-6'),
        step7: document.getElementById('step-7')
    };
    const verticalNavSteps = document.querySelectorAll('.steps-nav li');
    const horizontalIndicators = {
        indicator1: document.getElementById('horizontal-step-indicator-1'), indicator2: document.getElementById('horizontal-step-indicator-2'),
        indicator3: document.getElementById('horizontal-step-indicator-3'), indicator4: document.getElementById('horizontal-step-indicator-4'),
        indicator5: document.getElementById('horizontal-step-indicator-5'), indicator6: document.getElementById('horizontal-step-indicator-6'),
        indicator7: document.getElementById('horizontal-step-indicator-7')
    };
    const buttons = {
        next1: document.getElementById('next-step-1'),
        back2: document.getElementById('back-step-2'), next2: document.getElementById('next-step-2'),
        back3: document.getElementById('back-step-3'), next3: document.getElementById('next-step-3'),
        back4: document.getElementById('back-step-4'), next4: document.getElementById('next-step-4'), // New buttons for step 4
        back5: document.getElementById('back-step-5'), next5: document.getElementById('next-step-5'),
        back6: document.getElementById('back-step-6'), next6: document.getElementById('next-step-6'),
        back7: document.getElementById('back-step-7'), restart: document.getElementById('restartButton')
    };
    const inputs = {
        companySector: document.getElementById('companySector'),
        companySizeRadios: document.querySelectorAll('input[name="companySize"]'),
        manualEmployeeToggle: document.getElementById('manualEmployeeToggle'),
        manualEmployeeInputDiv: document.getElementById('manualEmployeeInputDiv'),
        exactEmployees: document.getElementById('exactEmployees'),
        manualDemographicsToggle: document.getElementById('manualDemographicsToggle'),
        manualDemographicsInputDiv: document.getElementById('manualDemographicsInputDiv'),
        manualMen: document.getElementById('manualMen'), manualWomen: document.getElementById('manualWomen'),
        manualBathroomsToggle: document.getElementById('manualBathroomsToggle'),
        manualBathroomsInputDiv: document.getElementById('manualBathroomsInputDiv'),
        manualBathrooms: document.getElementById('manualBathrooms'),
        audienceAdministrative: document.getElementById('audienceAdministrative'), // New
        audienceOperative: document.getElementById('audienceOperative'),       // New
        audienceFloating: document.getElementById('audienceFloating'),         // New
        percentBuscaPrecio: document.getElementById('percentBuscaPrecio'),
        percentBuscaCalidad: document.getElementById('percentBuscaCalidad'),
        percentBuscaConfort: document.getElementById('percentBuscaConfort'),
        segmentPercentInputs: document.querySelectorAll('.segment-percent')
    };
    const displays = {
        estimatedMen: document.getElementById('estimatedMen'), estimatedWomen: document.getElementById('estimatedWomen'),
        estimatedBathrooms: document.getElementById('estimatedBathrooms'),
        totalEmployeesForAudience: document.getElementById('totalEmployeesForAudience'), // New
        resultToiletPaper: document.getElementById('result-toilet-paper'),
        resultHandTowels: document.getElementById('result-hand-towels'),
        resultHandSoap: document.getElementById('result-hand-soap'),
        percentTotal: document.getElementById('percentTotal'),
        recommendedToiletPaper: document.getElementById('recommended-toilet-paper'),
        recommendedHandTowel: document.getElementById('recommended-hand-towel'),
        recommendedHandSoap: document.getElementById('recommended-hand-soap')
    };
    const errors = {
        sectorError: document.getElementById('sectorError'),
        employeeError: document.getElementById('employeeError'),
        demographicsError: document.getElementById('demographicsError'),
        bathroomError: document.getElementById('bathroomError'),
        audienceError: document.getElementById('audienceError'), // New
        percentError: document.getElementById('percentError')
    };

    // --- Estado de la Aplicación ---
    let currentStep = 1;
    let companyData = {
        sector: null,
        totalEmployees: null, men: null, women: null, bathrooms: null,
        audienceAdministrative: null, audienceOperative: null, audienceFloating: null, // New
        source: { employees: 'size', demographics: 'estimated', bathrooms: 'estimated' },
        segmentMix: { buscaPrecio: 30, buscaCalidad: 50, buscaConfort: 20 },
        calculationResults: { toiletPaper: 0, handTowels: 0, handSoap: 0 },
        recommendedProducts: { papelHigienico: null, toallasManos: null, jabonManos: null }
    };

    // --- Funciones de Utilidad (Calculadora) ---
    function updateStepIndicator() {
        verticalNavSteps.forEach((nav, index) => {
            nav.classList.remove('active', 'completed');
            if ((index + 1) === currentStep) nav.classList.add('active');
            else if ((index + 1) < currentStep) nav.classList.add('completed');
        });
        Object.values(horizontalIndicators).forEach((ind, index) => {
            if (ind) {
                const isActive = index + 1 === currentStep;
                const isCompleted = index + 1 < currentStep;
                ind.classList.toggle('step-active', isActive);
                ind.classList.toggle('step-completed', isCompleted);
                ind.classList.toggle('step-inactive', !isActive && !isCompleted);
                ind.classList.remove('bg-blue-600', 'text-white', 'bg-green-600', 'bg-gray-200', 'text-gray-600');
                if (isActive) ind.classList.add('bg-blue-600', 'text-white');
                else if (isCompleted) ind.classList.add('bg-green-600', 'text-white');
                else ind.classList.add('bg-gray-200', 'text-gray-600');
            }
        });
        Object.values(steps).forEach((step, index) => {
            const isActive = index + 1 === currentStep;
            step.classList.toggle('hidden', !isActive);
            if (isActive) {
                step.classList.remove('fade-leave-to', 'fade-leave-active', 'fade-enter-from');
                step.classList.add('fade-enter-active');
            } else {
                step.classList.remove('fade-enter-active');
            }
        });
         window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function getSelectedCompanySize() {
        for (const radio of inputs.companySizeRadios) { if (radio.checked) return radio.value; } return null;
    }

    function calculateInferredData(totalEmployees) {
        if (!totalEmployees || totalEmployees <= 0) return { men: 0, women: 0, bathrooms: 0 };
        const inferredMen = Math.round(totalEmployees * 0.60);
        const inferredWomen = totalEmployees - inferredMen;
        const inferredBathrooms = Math.ceil(totalEmployees / 15);
        return { men: inferredMen, women: inferredWomen, bathrooms: inferredBathrooms };
    }

    function updateStep3Display() {
        const totalEmployees = companyData.totalEmployees;
        if (totalEmployees > 0) {
            const inferred = calculateInferredData(totalEmployees);
            displays.estimatedMen.textContent = inferred.men;
            displays.estimatedWomen.textContent = inferred.women;
            displays.estimatedBathrooms.textContent = inferred.bathrooms;

            if (companyData.source.demographics === 'manual') {
                inputs.manualMen.value = companyData.men ?? '';
                inputs.manualWomen.value = companyData.women ?? '';
            } else {
                inputs.manualMen.value = ''; inputs.manualWomen.value = '';
                companyData.men = inferred.men; companyData.women = inferred.women;
            }
            if (companyData.source.bathrooms === 'manual') {
                inputs.manualBathrooms.value = companyData.bathrooms ?? '';
            } else {
                inputs.manualBathrooms.value = '';
                companyData.bathrooms = inferred.bathrooms;
            }
        } else {
            displays.estimatedMen.textContent = '--'; displays.estimatedWomen.textContent = '--'; displays.estimatedBathrooms.textContent = '--';
            inputs.manualMen.value = ''; inputs.manualWomen.value = ''; inputs.manualBathrooms.value = '';
        }
    }

    function updateStep4Display() { // For the new Audience Type step
        displays.totalEmployeesForAudience.textContent = companyData.totalEmployees > 0 ? companyData.totalEmployees : '--';
        inputs.audienceAdministrative.value = companyData.audienceAdministrative ?? '';
        inputs.audienceOperative.value = companyData.audienceOperative ?? '';
        inputs.audienceFloating.value = companyData.audienceFloating ?? '';
    }


    function calculateMonthlyUsage() {
        const men = companyData.men ?? 0;
        const women = companyData.women ?? 0;
        console.log(companyData)
        // Note: Audience type data (administrative, operative, floating) is not currently used in this calculation.
        // The calculation remains based on men/women demographics from step 3.
        const toiletPaperUsage = (women * RATES.women.toiletPaper + men * RATES.men.toiletPaper) * AVG_MONTHLY_WORK_HOURS;
        const handTowelsUsage = (women * RATES.women.handTowels + men * RATES.men.handTowels) * AVG_MONTHLY_WORK_HOURS;
        const handSoapUsage = (women * RATES.women.handSoap + men * RATES.men.handSoap) * AVG_MONTHLY_WORK_HOURS;
        const results = {
            toiletPaper: Math.round(toiletPaperUsage),
            handTowels: Math.round(handTowelsUsage),
            handSoap: Math.round(handSoapUsage)
        };
        companyData.calculationResults = results;
        return results;
    }

    function updateResultsDisplay(results) {
        displays.resultToiletPaper.textContent = `${results.toiletPaper.toLocaleString('es-CO')} usos/mes`;
        displays.resultHandTowels.textContent = `${results.handTowels.toLocaleString('es-CO')} usos/mes`;
        displays.resultHandSoap.textContent = `${results.handSoap.toLocaleString('es-CO')} usos/mes`;
    }

    function hideAllErrors() {
        Object.values(errors).forEach(errorEl => errorEl.classList.add('hidden'));
    }

    function validateStep1() {
        hideAllErrors();
        if (!inputs.companySector.value) {
            errors.sectorError.classList.remove('hidden');
            inputs.companySector.focus();
            return false;
        }
        companyData.sector = inputs.companySector.value;
        return true;
    }

    function validateStep2() {
        hideAllErrors();
        const isManual = inputs.manualEmployeeToggle.checked;
        const exactValue = parseInt(inputs.exactEmployees.value, 10);
        const sizeSelected = getSelectedCompanySize();

        if (isManual) {
            if (!exactValue || exactValue <= 0 || exactValue < 11) {
                errors.employeeError.textContent = 'Por favor, ingresa un número válido de empleados (mínimo 11).';
                errors.employeeError.classList.remove('hidden');
                inputs.exactEmployees.focus();
                return false;
            }
            companyData.totalEmployees = exactValue;
            companyData.source.employees = 'manual';
        } else {
            if (!sizeSelected) {
                errors.employeeError.textContent = 'Por favor, selecciona un tamaño de empresa.';
                errors.employeeError.classList.remove('hidden');
                return false;
            }
            let representativeValue = SIZE_DEFAULTS[sizeSelected];
            if (sizeSelected === 'small' && representativeValue < 11) representativeValue = 11;
            companyData.totalEmployees = representativeValue;
            companyData.source.employees = 'size';
        }
        return true;
    }

    function validateStep3() {
        hideAllErrors();
        let isValid = true;
        const totalEmployees = companyData.totalEmployees;
        if (!totalEmployees || totalEmployees <= 0) {
            console.error("Error: Total employees not set before validating step 3.");
            return false;
        }

        if (inputs.manualDemographicsToggle.checked) {
            const manualMen = parseInt(inputs.manualMen.value, 10);
            const manualWomen = parseInt(inputs.manualWomen.value, 10);
            if (isNaN(manualMen) || manualMen < 0 || isNaN(manualWomen) || manualWomen < 0) {
                errors.demographicsError.textContent = 'Ingresa números válidos para hombres y mujeres.';
                errors.demographicsError.classList.remove('hidden'); isValid = false;
            } else if (manualMen + manualWomen !== totalEmployees) {
                errors.demographicsError.textContent = `La suma (${manualMen + manualWomen}) debe ser igual al total de empleados (${totalEmployees}).`;
                errors.demographicsError.classList.remove('hidden'); isValid = false;
            } else {
                companyData.men = manualMen; companyData.women = manualWomen;
                companyData.source.demographics = 'manual';
            }
        } else {
            const inferred = calculateInferredData(totalEmployees);
            companyData.men = inferred.men; companyData.women = inferred.women;
            companyData.source.demographics = 'estimated';
        }

        if (inputs.manualBathroomsToggle.checked) {
            const manualBathrooms = parseInt(inputs.manualBathrooms.value, 10);
            if (!manualBathrooms || manualBathrooms <= 0) {
                errors.bathroomError.textContent = 'Por favor, ingresa un número válido de baños (mínimo 1).';
                errors.bathroomError.classList.remove('hidden'); isValid = false;
            } else {
                companyData.bathrooms = manualBathrooms;
                companyData.source.bathrooms = 'manual';
            }
        } else {
            const inferred = calculateInferredData(totalEmployees);
            companyData.bathrooms = inferred.bathrooms;
            companyData.source.bathrooms = 'estimated';
        }
        return isValid;
    }

    function validateStep4_audience() { // New validation for Audience Types (Step 4)
        hideAllErrors();
        const admin = parseInt(inputs.audienceAdministrative.value, 10);
        const operative = parseInt(inputs.audienceOperative.value, 10);
        const floating = parseInt(inputs.audienceFloating.value, 10);
        const totalEmployees = companyData.totalEmployees;

        if (isNaN(admin) || admin < 0 || isNaN(operative) || operative < 0 || isNaN(floating) || floating < 0) {
            errors.audienceError.textContent = 'Por favor, ingresa números válidos para cada tipo de público.';
            errors.audienceError.classList.remove('hidden');
            return false;
        }
        // Los operativos no cuentan como empleados
        const sumAudience = admin + operative;
        if (sumAudience !== totalEmployees) {
            errors.audienceError.textContent = `La suma de los tipos de público (${sumAudience}) debe ser igual al total de empleados (${totalEmployees}).`;
            errors.audienceError.classList.remove('hidden');
            return false;
        }
        companyData.audienceAdministrative = admin;
        companyData.audienceOperative = operative;
        companyData.audienceFloating = floating;
        return true;
    }


    function validateStep6_segments() { // Formerly validateStep5, now for Step 6 (Segment Mix)
        hideAllErrors();
        const buscaPrecio = parseInt(inputs.percentBuscaPrecio.value, 10) || 0;
        const buscaCalidad = parseInt(inputs.percentBuscaCalidad.value, 10) || 0;
        const buscaConfort = parseInt(inputs.percentBuscaConfort.value, 10) || 0;
        const total = buscaPrecio + buscaCalidad + buscaConfort;

        displays.percentTotal.textContent = `Total: ${total}%`;
        if (total !== 100) {
            errors.percentError.classList.remove('hidden');
            buttons.next6.classList.add('btn-disabled');
            buttons.next6.disabled = true;
            return false;
        } else {
            errors.percentError.classList.add('hidden');
            companyData.segmentMix.buscaPrecio = buscaPrecio;
            companyData.segmentMix.buscaCalidad = buscaCalidad;
            companyData.segmentMix.buscaConfort = buscaConfort;
            buttons.next6.classList.remove('btn-disabled');
            buttons.next6.disabled = false;
            return true;
        }
    }

    function selectTorkProducts() {
        const mix = companyData.segmentMix;
        const pPrecio = mix.buscaPrecio / 100;
        const pCalidad = mix.buscaCalidad / 100;
        // pConfort is 1 - pPrecio - pCalidad

        const selected = { papelHigienico: null, toallasManos: null, jabonManos: null };

        const selectProduct = (productTypeKey) => {
            const random = Math.random();
            let targetQuality;

            if (random < pPrecio) targetQuality = qualityMapping.buscaPrecio;
            else if (random < pPrecio + pCalidad) targetQuality = qualityMapping.buscaCalidad;
            else targetQuality = qualityMapping.buscaConfort;

            let availableProducts = torkProducts[productTypeKey].filter(p => p.calidad === targetQuality);

            if (availableProducts.length === 0) {
                if (targetQuality === qualityMapping.buscaConfort) {
                    availableProducts = torkProducts[productTypeKey].filter(p => p.calidad === qualityMapping.buscaCalidad);
                }
                if (availableProducts.length === 0 && targetQuality !== qualityMapping.buscaPrecio) {
                     availableProducts = torkProducts[productTypeKey].filter(p => p.calidad === qualityMapping.buscaPrecio);
                }
                if (availableProducts.length === 0) {
                    availableProducts = torkProducts[productTypeKey];
                }
            }
            if (availableProducts.length === 0) return null;
            return availableProducts[Math.floor(Math.random() * availableProducts.length)];
        };

        selected.papelHigienico = selectProduct('papelHigienico');
        selected.toallasManos = selectProduct('toallasManos');
        selected.jabonManos = selectProduct('jabonManos');

        companyData.recommendedProducts = selected;
        return selected;
    }

    function displaySelectedProducts(selectedProducts) {
        const formatCurrency = (value) => {
            if (typeof value !== 'number' || isNaN(value)) return 'N/A';
            return value.toLocaleString('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0, maximumFractionDigits: 0 });
        };

        const calculateQuantity = (productTypeKey, product, monthlyUsage) => {
            if (!product || monthlyUsage <= 0) return 1;
            let usesPerPaca = 1000;

            try {
                if (productTypeKey === 'papelHigienico') {
                    if (product.metros && product.rollosXPaca) {
                        const rollos = parseInt(String(product.rollosXPaca).match(/\d+/)?.[0] || '1');
                        usesPerPaca = product.metros * rollos * 0.8;
                    } else if (product.hojas && product.rollosXPaca) {
                        const rollos = parseInt(String(product.rollosXPaca).match(/\d+/)?.[0] || '1');
                        usesPerPaca = product.hojas * rollos * 0.5;
                    }
                } else if (productTypeKey === 'toallasManos') {
                     if (product.metros && product.rollosXPaca) {
                        const rollos = parseInt(String(product.rollosXPaca).match(/\d+/)?.[0] || '1');
                        usesPerPaca = product.metros * rollos * 2;
                    } else if (product.hojas && product.paca) {
                         usesPerPaca = product.hojas * 1;
                    }
                } else if (productTypeKey === 'jabonManos') {
                    if (product.volumen && product.paca) {
                        const volumeMl = parseFloat(String(product.volumen).replace(/[^0-9.]/g, '')) || 0;
                        const unitsPerPaca = product.paca || 1;
                        const mlPerUse = product.descripcion.toLowerCase().includes('espuma') ? 0.4 : 1.5;
                        if (volumeMl > 0 && mlPerUse > 0) {
                            usesPerPaca = (volumeMl / mlPerUse) * unitsPerPaca;
                        }
                    }
                }
            } catch (e) {
                console.error("Error calculating usesPerPaca:", e, product);
            }

            if (usesPerPaca <= 0) usesPerPaca = 1;
            const quantity = Math.ceil(monthlyUsage / usesPerPaca);
            return quantity > 0 ? quantity : 1;
        };

        const renderProduct = (product, productTypeKey, monthlyUsage) => {
            if (!product) {
                return `<p class="italic text-center text-red-500 p-4 bg-red-50 rounded border border-dashed border-red-300">No se pudo seleccionar un producto adecuado. Intente ajustar la mezcla de segmentos o contacte a un asesor.</p>`;
            }
            const placeholderImg = 'https://placehold.co/200x200/e0e7ff/3730a3?text=Producto';
            const imageUrl = product.imagenURL || placeholderImg;
            const price = typeof product.precioUnitario === 'number' ? product.precioUnitario : 0;
            const quantityPacas = calculateQuantity(productTypeKey, product, monthlyUsage);
            const outlay = quantityPacas * price;

            let productHtml = `<div class="recommendation-layout">`;
            productHtml += `<div class="image-column">
                                <img src="${imageUrl}" alt="${product.descripcion || 'Producto Tork'}" class="product-image" onerror="this.onerror=null;this.src='${placeholderImg}';">
                            </div>`;
            productHtml += `<div class="text-column">`;
            productHtml += `<h4 class="product-title">${product.descripcion}</h4>`;
            productHtml += `<div class="details-grid">`;
            productHtml += `<p><span>Código:</span> <span class="font-medium">${product.codigo || 'N/A'}</span></p>`;
            if (product.metros) productHtml += `<p><span>Metros/Rollo:</span> <span class="font-medium">${product.metros}</span></p>`;
            if (product.volumen) productHtml += `<p><span>Volumen/Unidad:</span> <span class="font-medium">${product.volumen}</span></p>`;
            if (product.hojas) productHtml += `<p><span>Hojas/Rollo:</span> <span class="font-medium">${product.hojas}</span></p>`;
            if (product.color) productHtml += `<p><span>Color:</span> <span class="font-medium">${product.color}</span></p>`;
            if (product.tipo) productHtml += `<p><span>Tipo Jabón:</span> <span class="font-medium">${product.tipo}</span></p>`;
            productHtml += `<p><span>Calidad Tork:</span> <span class="font-semibold">${product.calidad || 'N/A'}</span></p>`;
            if (product.papel) productHtml += `<p><span>Tipo Papel:</span> <span class="font-medium">${product.papel}</span></p>`;
            if (product.rollosXPaca) productHtml += `<p><span>Unidades/Paca:</span> <span class="font-medium">${product.rollosXPaca}</span></p>`;
            else if (product.paca) productHtml += `<p><span>Unidades/Paca:</span> <span class="font-medium">${product.paca}</span></p>`;
            if (product.dispensador) productHtml += `<p><span>Dispensador:</span> <span class="font-medium">${product.dispensador}</span></p>`;
            productHtml += `</div>`;
            productHtml += `<div class="calculated-values">`;
            productHtml += `<p><span class="font-medium text-gray-700">Cantidad Estimada (Pacas/Mes):</span> <span class="value">${quantityPacas.toLocaleString('es-CO')}</span> <span class="usage-context">(para ${monthlyUsage.toLocaleString('es-CO')} usos/mes)</span></p>`;
            productHtml += `<p><span class="font-medium text-gray-700">Precio Unitario (Paca):</span> <span class="price-value">${formatCurrency(price)}</span></p>`;
            productHtml += `<p><span class="font-medium text-gray-700">Desembolso Mensual Estimado:</span> <span class="outlay-value">${formatCurrency(outlay)}</span></p>`;
            productHtml += `</div>`;
            productHtml += `</div>`;
            productHtml += `</div>`;
            return productHtml;
        };

        displays.recommendedToiletPaper.innerHTML = renderProduct(selectedProducts.papelHigienico, 'papelHigienico', companyData.calculationResults.toiletPaper);
        displays.recommendedHandTowel.innerHTML = renderProduct(selectedProducts.toallasManos, 'toallasManos', companyData.calculationResults.handTowels);
        displays.recommendedHandSoap.innerHTML = renderProduct(selectedProducts.jabonManos, 'jabonManos', companyData.calculationResults.handSoap);
    }


    // --- Event Listeners (Calculadora) ---
    // Step 1: Sector
    buttons.next1.addEventListener('click', () => {
        if (validateStep1()) {
            currentStep = 2; updateStepIndicator();
        }
    });

    // Step 2: Tamaño Empresa
    inputs.manualEmployeeToggle.addEventListener('change', (e) => {
        const isChecked = e.target.checked;
        inputs.manualEmployeeInputDiv.classList.toggle('hidden', !isChecked);
        companyData.source.employees = isChecked ? 'manual' : 'size';
        hideAllErrors();
        if (isChecked) {
            inputs.companySizeRadios.forEach(radio => radio.checked = false);
            inputs.exactEmployees.value = ''; inputs.exactEmployees.focus();
        } else { inputs.exactEmployees.value = ''; }
    });
    inputs.companySizeRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            if (radio.checked) {
                inputs.manualEmployeeToggle.checked = false;
                inputs.manualEmployeeInputDiv.classList.add('hidden');
                inputs.exactEmployees.value = '';
                companyData.source.employees = 'size'; hideAllErrors();
            }
        });
    });
    buttons.back2.addEventListener('click', () => { currentStep = 1; updateStepIndicator(); hideAllErrors(); });
    buttons.next2.addEventListener('click', () => {
        if (validateStep2()) {
            updateStep3Display();
            currentStep = 3; updateStepIndicator();
        }
    });

    // Step 3: Demografía y Baños
    inputs.manualDemographicsToggle.addEventListener('change', (e) => {
        const isChecked = e.target.checked;
        inputs.manualDemographicsInputDiv.classList.toggle('hidden', !isChecked);
        companyData.source.demographics = isChecked ? 'manual' : 'estimated';
        hideAllErrors();
        if(isChecked) { inputs.manualMen.value = ''; inputs.manualWomen.value = ''; inputs.manualMen.focus(); }
        updateStep3Display();
    });
    inputs.manualBathroomsToggle.addEventListener('change', (e) => {
        const isChecked = e.target.checked;
        inputs.manualBathroomsInputDiv.classList.toggle('hidden', !isChecked);
        companyData.source.bathrooms = isChecked ? 'manual' : 'estimated';
        hideAllErrors();
        if(isChecked) { inputs.manualBathrooms.value = ''; inputs.manualBathrooms.focus(); }
        updateStep3Display();
    });
    buttons.back3.addEventListener('click', () => { currentStep = 2; updateStepIndicator(); hideAllErrors(); });
    buttons.next3.addEventListener('click', () => {
        if (validateStep3()) {
            updateStep4Display(); // Prepare display for the new step 4
            currentStep = 4; updateStepIndicator();
        }
    });

    // Step 4: Tipos de Publico (New)
    buttons.back4.addEventListener('click', () => { currentStep = 3; updateStepIndicator(); hideAllErrors(); });
    buttons.next4.addEventListener('click', () => {
        if (validateStep4_audience()) {
            const results = calculateMonthlyUsage(); // Calculate consumption based on step 3 demographics
            updateResultsDisplay(results);         // Populate step 5 display
            currentStep = 5; updateStepIndicator();
        }
    });


    // Step 5: Estimación Consumo (Formerly Step 4)
    buttons.back5.addEventListener('click', () => { currentStep = 4; updateStepIndicator(); });
    buttons.next5.addEventListener('click', () => {
        inputs.percentBuscaPrecio.value = companyData.segmentMix.buscaPrecio;
        inputs.percentBuscaCalidad.value = companyData.segmentMix.buscaCalidad;
        inputs.percentBuscaConfort.value = companyData.segmentMix.buscaConfort;
        validateStep6_segments();
        currentStep = 6; updateStepIndicator();
    });

    // Step 6: Mezcla Segmentos (Formerly Step 5)
    buttons.back6.addEventListener('click', () => { currentStep = 5; updateStepIndicator(); hideAllErrors(); });
    inputs.segmentPercentInputs.forEach(input => { input.addEventListener('input', validateStep6_segments); });
    buttons.next6.addEventListener('click', () => {
        if (validateStep6_segments()) {
            displays.recommendedToiletPaper.innerHTML = '<p class="italic">Calculando...</p>';
            displays.recommendedHandTowel.innerHTML = '<p class="italic">Calculando...</p>';
            displays.recommendedHandSoap.innerHTML = '<p class="italic">Calculando...</p>';
            currentStep = 7; updateStepIndicator();
            setTimeout(() => {
                const selectedProducts = selectTorkProducts();
                displaySelectedProducts(selectedProducts);
            }, 50);
        }
    });

    // Step 7: Recomendación (Formerly Step 6)
    buttons.back7.addEventListener('click', () => { currentStep = 6; updateStepIndicator(); });
    buttons.restart.addEventListener('click', () => { location.reload(); });

    // --- Inicialización ---
    document.addEventListener('DOMContentLoaded', () => {
        updateStepIndicator();
        validateStep6_segments(); // Initialize segment mix validation for what is now step 6

        const statContainer = document.getElementById('changing-stat-container');
        const messages = [
            `<div class="stat-container"><div class="stat-number">97<span class="percentage">%</span></div><div class="stat-text">de clientes afirma que nuestro sistema<br>ayuda a mejorar la higiene<br>en sus instalaciones*</div></div>`,
            `<div class="stat-container"><div class="stat-number">85<span class="percentage">%</span></div><div class="stat-text">reporta una reducción<br>significativa en<br>el consumo*</div></div>`,
            `<div class="stat-container"><div class="stat-number">50<span class="percentage">%</span></div><div class="stat-text">menos tiempo dedicado<br>a rellenar<br>dispensadores*</div></div>`,
            `<div class="stat-container"><div class="stat-number">90<span class="percentage">%</span></div><div class="stat-text">está de acuerdo en que los<br>productos Tork son<br>de alta calidad*</div></div>`
        ];
        let currentMessageIndex = 0;
        function showNextMessage() {
            if (statContainer) {
                statContainer.innerHTML = messages[currentMessageIndex];
                currentMessageIndex = (currentMessageIndex + 1) % messages.length;
            }
        }
        if (statContainer) {
            showNextMessage();
            setInterval(showNextMessage, 7000);
        }

        let lastScrollTop = 0;
        const navbar = document.getElementById('autoHideNavbar');
        if (navbar) {
            window.addEventListener("scroll", function() {
                let currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                if (currentScroll > lastScrollTop && currentScroll > navbar.offsetHeight) {
                    navbar.style.top = `-${navbar.offsetHeight}px`;
                } else {
                    navbar.style.top = "0";
                }
                lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
            }, false);
        }
    });
    </script>
    </body>
</html>